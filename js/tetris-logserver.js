var logserver=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";const r=n(20),i=n(21),o=n(3),{kStatusCode:s,NOOP:a}=n(0),c=Buffer.from([0,0,255,255]),l=Buffer.from([0]),u=Symbol("permessage-deflate"),h=Symbol("total-length"),f=Symbol("callback"),d=Symbol("buffers"),v=Symbol("error");let p;function g(e){this[d].push(e),this[h]+=e.length}function y(e){this[h]+=e.length,this[u]._maxPayload<1||this[h]<=this[u]._maxPayload?this[d].push(e):(this[v]=new RangeError("Max payload size exceeded"),this[v][s]=1009,this.removeListener("data",y),this.reset())}function m(e){this[u]._inflate=null,e[s]=1007,this[f](e)}e.exports=class{constructor(e,t,n){if(this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!p){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;p=new r({concurrency:e})}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate[f]&&this._deflate[f](),this._deflate.close(),this._deflate=null)}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){p.push(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){p.push(r=>{this._compress(e,t,(e,t)=>{r(),(e||t)&&n(e,t)})})}_decompress(e,t,n){const r=this._isServer?"client":"server";if(!this._inflate){const e=r+"_max_window_bits",t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[u]=this,this._inflate[h]=0,this._inflate[d]=[],this._inflate.on("error",m),this._inflate.on("data",y)}this._inflate[f]=n,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{const e=this._inflate[v];if(e)return this._inflate.close(),this._inflate=null,void n(e);const i=o.concat(this._inflate[d],this._inflate[h]);t&&this.params[r+"_no_context_takeover"]?(this._inflate.close(),this._inflate=null):(this._inflate[h]=0,this._inflate[d]=[]),n(null,i)})}_compress(e,t,n){if(!e||0===e.length)return void process.nextTick(n,null,l);const r=this._isServer?"server":"client";if(!this._deflate){const e=r+"_max_window_bits",t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[h]=0,this._deflate[d]=[],this._deflate.on("error",a),this._deflate.on("data",g)}this._deflate[f]=n,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[d],this._deflate[h]);t&&(e=e.slice(0,e.length-4)),this._deflate[f]=null,t&&this.params[r+"_no_context_takeover"]?(this._deflate.close(),this._deflate=null):(this._deflate[h]=0,this._deflate[d]=[]),n(null,e)})}}},function(e,t,n){"use strict";const{EMPTY_BUFFER:r}=n(0);function i(e,t){if(0===e.length)return r;if(1===e.length)return e[0];const n=Buffer.allocUnsafe(t);let i=0;for(let t=0;t<e.length;t++){const r=e[t];n.set(r,i),i+=r.length}return i<t?n.slice(0,i):n}function o(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[o]^t[3&o]}function s(e,t){const n=e.length;for(let r=0;r<n;r++)e[r]^=t[3&r]}function a(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function c(e){if(c.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=Buffer.from(e):ArrayBuffer.isView(e)?t=function(e){const t=Buffer.from(e.buffer);if(e.byteLength!==e.buffer.byteLength)return t.slice(e.byteOffset,e.byteOffset+e.byteLength);return t}(e):(t=Buffer.from(e),c.readOnly=!1),t}try{const t=n(22),r=t.BufferUtil||t;e.exports={concat:i,mask(e,t,n,i,s){s<48?o(e,t,n,i,s):r.mask(e,t,n,i,s)},toArrayBuffer:a,toBuffer:c,unmask(e,t){e.length<32?s(e,t):r.unmask(e,t)}}}catch(t){e.exports={concat:i,mask:o,toArrayBuffer:a,toBuffer:c,unmask:s}}},function(e,t,n){"use strict";const r=n(5);r.createWebSocketStream=n(29),r.Server=n(30),r.Receiver=n(10),r.Sender=n(13),e.exports=r},function(e,t,n){"use strict";const r=n(6),i=n(16),o=n(7),s=n(17),a=n(18),{randomBytes:c,createHash:l}=n(1),{URL:u}=n(19),h=n(2),f=n(10),d=n(13),{BINARY_TYPES:v,EMPTY_BUFFER:p,GUID:g,kStatusCode:y,kWebSocket:m,NOOP:b}=n(0),{addEventListener:w,removeEventListener:_}=n(28),{format:k,parse:x}=n(14),{toBuffer:S}=n(3),E=["CONNECTING","OPEN","CLOSING","CLOSED"],O=[8,13];class T extends r{constructor(e,t,n){super(),this.readyState=T.CONNECTING,this.protocol="",this._binaryType=v[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(n=t,t=void 0),function e(t,n,r,s){const a={protocolVersion:O[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0};if(!O.includes(a.protocolVersion))throw new RangeError(`Unsupported protocol version: ${a.protocolVersion} (supported versions: ${O.join(", ")})`);let f;n instanceof u?(f=n,t.url=n.href):(f=new u(n),t.url=n);const d="ws+unix:"===f.protocol;if(!(f.host||d&&f.pathname))throw new Error("Invalid URL: "+t.url);const v="wss:"===f.protocol||"https:"===f.protocol,p=v?443:80,y=c(16).toString("base64"),m=v?i.get:o.get;let b;a.createConnection=v?L:N,a.defaultPort=a.defaultPort||p,a.port=f.port||p,a.host=f.hostname.startsWith("[")?f.hostname.slice(1,-1):f.hostname,a.headers={"Sec-WebSocket-Version":a.protocolVersion,"Sec-WebSocket-Key":y,Connection:"Upgrade",Upgrade:"websocket",...a.headers},a.path=f.pathname+f.search,a.timeout=a.handshakeTimeout,a.perMessageDeflate&&(b=new h(!0!==a.perMessageDeflate?a.perMessageDeflate:{},!1,a.maxPayload),a.headers["Sec-WebSocket-Extensions"]=k({[h.extensionName]:b.offer()}));r&&(a.headers["Sec-WebSocket-Protocol"]=r);a.origin&&(a.protocolVersion<13?a.headers["Sec-WebSocket-Origin"]=a.origin:a.headers.Origin=a.origin);(f.username||f.password)&&(a.auth=`${f.username}:${f.password}`);if(d){const e=a.path.split(":");a.socketPath=e[0],a.path=e[1]}let w=t._req=m(a);a.timeout&&w.on("timeout",()=>{M(t,w,"Opening handshake has timed out")});w.on("error",e=>{t._req.aborted||(w=t._req=null,t.readyState=T.CLOSING,t.emit("error",e),t.emitClose())}),w.on("response",i=>{const o=i.headers.location,c=i.statusCode;if(o&&a.followRedirects&&c>=300&&c<400){if(++t._redirects>a.maxRedirects)return void M(t,w,"Maximum redirects exceeded");w.abort();const i=new u(o,n);e(t,i,r,s)}else t.emit("unexpected-response",w,i)||M(t,w,"Unexpected server response: "+i.statusCode)}),w.on("upgrade",(e,n,i)=>{if(t.emit("upgrade",e),t.readyState!==T.CONNECTING)return;w=t._req=null;const o=l("sha1").update(y+g).digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void M(t,n,"Invalid Sec-WebSocket-Accept header");const s=e.headers["sec-websocket-protocol"],c=(r||"").split(/, */);let u;if(!r&&s?u="Server sent a subprotocol but none was requested":r&&!s?u="Server sent no subprotocol":s&&!c.includes(s)&&(u="Server sent an invalid subprotocol"),u)M(t,n,u);else{if(s&&(t.protocol=s),b)try{const n=x(e.headers["sec-websocket-extensions"]);n[h.extensionName]&&(b.accept(n[h.extensionName]),t._extensions[h.extensionName]=b)}catch(e){return void M(t,n,"Invalid Sec-WebSocket-Extensions header")}t.setSocket(n,i,a.maxPayload)}})}(this,e,t,n)):this._isServer=!0}get CONNECTING(){return T.CONNECTING}get CLOSING(){return T.CLOSING}get CLOSED(){return T.CLOSED}get OPEN(){return T.OPEN}get binaryType(){return this._binaryType}set binaryType(e){v.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){const r=new f(this._binaryType,this._extensions,n);this._sender=new d(e,this._extensions),this._receiver=r,this._socket=e,r[m]=this,e[m]=this,r.on("conclude",C),r.on("drain",I),r.on("error",P),r.on("message",A),r.on("ping",j),r.on("pong",U),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",R),e.on("data",D),e.on("end",G),e.on("error",F),this.readyState=T.OPEN,this.emit("open")}emitClose(){this.readyState=T.CLOSED,this._socket?(this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==T.CLOSED){if(this.readyState===T.CONNECTING){const e="WebSocket was closed before the connection was established";return M(this,this._req,e)}this.readyState!==T.CLOSING?(this.readyState=T.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,n){if(this.readyState===T.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===T.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||p,t,n)):B(this,e,n)}pong(e,t,n){if(this.readyState===T.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===T.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||p,t,n)):B(this,e,n)}send(e,t,n){if(this.readyState===T.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==T.OPEN)return void B(this,e,n);const r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(r.compress=!1),this._sender.send(e||p,r,n)}terminate(){if(this.readyState!==T.CLOSED){if(this.readyState===T.CONNECTING){const e="WebSocket was closed before the connection was established";return M(this,this._req,e)}this._socket&&(this.readyState=T.CLOSING,this._socket.destroy())}}}function N(e){return e.path=e.socketPath,s.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=e.host),a.connect(e)}function M(e,t,n){e.readyState=T.CLOSING;const r=new Error(n);Error.captureStackTrace(r,M),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function B(e,t,n){if(t){const n=S(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){n(new Error(`WebSocket is not open: readyState ${e.readyState} (${E[e.readyState]})`))}}function C(e,t){const n=this[m];n._socket.removeListener("data",D),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,1005===e?n.close():n.close(e,t)}function I(){this[m]._socket.resume()}function P(e){const t=this[m];t._socket.removeListener("data",D),t.readyState=T.CLOSING,t._closeCode=e[y],t.emit("error",e),t._socket.destroy()}function W(){this[m].emitClose()}function A(e){this[m].emit("message",e)}function j(e){const t=this[m];t.pong(e,!t._isServer,b),t.emit("ping",e)}function U(e){this[m].emit("pong",e)}function R(){const e=this[m];this.removeListener("close",R),this.removeListener("end",G),e.readyState=T.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",D),this[m]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",W),e._receiver.on("finish",W))}function D(e){this[m]._receiver.write(e)||this.pause()}function G(){const e=this[m];e.readyState=T.CLOSING,e._receiver.end(),this.end()}function F(){const e=this[m];this.removeListener("error",F),this.on("error",b),e&&(e.readyState=T.CLOSING,this.destroy())}E.forEach((e,t)=>{T[e]=t}),["open","error","close","message"].forEach(e=>{Object.defineProperty(T.prototype,"on"+e,{get(){const t=this.listeners(e);for(let e=0;e<t.length;e++)if(t[e]._listener)return t[e]._listener},set(t){const n=this.listeners(e);for(let t=0;t<n.length;t++)n[t]._listener&&this.removeListener(e,n[t]);this.addEventListener(e,t)}})}),T.prototype.addEventListener=w,T.prototype.removeEventListener=_,e.exports=T},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(9),i=n(23),o=n(24),s=require,a=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,l=process.versions.modules,u=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":"node",h=o.arch(),f=o.platform(),d=process.env.LIBC||(function(e){return"linux"===e&&r.existsSync("/etc/alpine-release")}(f)?"musl":"glibc"),v=process.env.ARM_VERSION||("arm64"===h?"8":a.arm_version)||"",p=(process.versions.uv||"").split(".")[0];function g(e){return s(g.path(e))}function y(e){try{return r.readdirSync(e)}catch(e){return[]}}function m(e,t){var n=y(e).filter(t);return n[0]&&i.join(e,n[0])}function b(e){return/\.node$/.test(e)}function w(e){var t=e.split("."),n={file:e,specificity:0};if("node"===t.pop()){for(var r=0;r<t.length;r++){var i=t[r];if("node"===i||"electron"===i||"node-webkit"===i)n.runtime=i;else if("napi"===i)n.napi=!0;else if("abi"===i.slice(0,3))n.abi=i.slice(3);else if("uv"===i.slice(0,2))n.uv=i.slice(2);else if("armv"===i.slice(0,4))n.armv=i.slice(4);else{if("glibc"!==i&&"musl"!==i)continue;n.libc=i}n.specificity++}return n}}function _(e,t){return function(n){return null!=n&&(!(n.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(n))&&(!(n.abi!==t&&!n.napi)&&((!n.uv||n.uv===p)&&((!n.armv||n.armv===v)&&(!n.libc||n.libc===d)))))}}function k(e){return function(t,n){return t.runtime!==n.runtime?t.runtime===e?-1:1:t.abi!==n.abi?t.abi?-1:1:t.specificity!==n.specificity?t.specificity>n.specificity?-1:1:0}}e.exports=g,g.path=function(e){e=i.resolve(e||".");try{var t=s(i.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!c){var n=m(i.join(e,"build/Release"),b);if(n)return n;var r=m(i.join(e,"build/Debug"),b);if(r)return r}var o=x(e);if(o)return o;var a=x(i.dirname(process.execPath));if(a)return a;var g=["platform="+f,"arch="+h,"runtime="+u,"abi="+l,"uv="+p,v?"armv="+v:"","libc="+d,"node="+process.versions.node,process.versions&&process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+g+"\n    loaded from: "+e+"\n");function x(e){var t=i.join(e,"prebuilds",f+"-"+h),n=y(t).map(w).filter(_(u,l)).sort(k(u))[0];if(n)return i.join(t,n.file)}},g.parseTags=w,g.matchTags=_,g.compareTags=k},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";const{Writable:r}=n(11),i=n(2),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:c}=n(0),{concat:l,toArrayBuffer:u,unmask:h}=n(3),{isValidStatusCode:f,isValidUTF8:d}=n(12);function v(e,t,n,r){const i=new e(n?"Invalid WebSocket frame: "+t:t);return Error.captureStackTrace(i,v),i[a]=r,i}e.exports=class extends r{constructor(e,t,n){super(),this._binaryType=e||o[0],this[c]=void 0,this._extensions=t||{},this._maxPayload=0|n,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,v(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[i.extensionName])return this._loop=!1,v(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,v(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,v(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,v(RangeError,"invalid opcode "+this._opcode,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,v(RangeError,"invalid opcode "+this._opcode,!0,1002);if(!this._fin)return this._loop=!1,v(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,v(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,v(RangeError,"invalid payload length "+this._payloadLength,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,v(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,v(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&h(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(v(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)})}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?l(t,e):"arraybuffer"===this._binaryType?u(l(t,e)):t,this.emit("message",n)}else{const n=l(t,e);if(!d(n))return this._loop=!1,v(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",n.toString())}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return v(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!f(t))return v(RangeError,"invalid status code "+t,!0,1002);const n=e.slice(2);if(!d(n))return v(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";try{const e=n(26);t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=()=>!0}t.isValidStatusCode=e=>e>=1e3&&e<=1013&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},function(e,t,n){"use strict";const{randomFillSync:r}=n(1),i=n(2),{EMPTY_BUFFER:o}=n(0),{isValidStatusCode:s}=n(12),{mask:a,toBuffer:c}=n(3),l=Buffer.alloc(4);class u{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const n=t.mask&&t.readOnly;let i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);const s=Buffer.allocUnsafe(n?e.length+i:i);return s[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,126===o?s.writeUInt16BE(e.length,2):127===o&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),t.mask?(r(l,0,4),s[1]|=128,s[i-4]=l[0],s[i-3]=l[1],s[i-2]=l[2],s[i-1]=l[3],n?(a(e,l,s,i,e.length),[s]):(a(e,l,e,0,e.length),[s,e])):[s,e]}close(e,t,n,r){let i;if(void 0===e)i=o;else{if("number"!=typeof e||!s(e))throw new TypeError("First argument must be a valid error code number");void 0===t||""===t?(i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0)):(i=Buffer.allocUnsafe(2+Buffer.byteLength(t)),i.writeUInt16BE(e,0),i.write(t,2))}this._deflating?this.enqueue([this.doClose,i,n,r]):this.doClose(i,n,r)}doClose(e,t,n){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){const r=c(e);this._deflating?this.enqueue([this.doPing,r,t,c.readOnly,n]):this.doPing(r,t,c.readOnly,n)}doPing(e,t,n,r){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),r)}pong(e,t,n){const r=c(e);this._deflating?this.enqueue([this.doPong,r,t,c.readOnly,n]):this.doPong(r,t,c.readOnly,n)}doPong(e,t,n,r){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),r)}send(e,t,n){const r=c(e),o=this._extensions[i.extensionName];let s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=r.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){const e={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:c.readOnly};this._deflating?this.enqueue([this.dispatch,r,this._compress,e,n]):this.dispatch(r,this._compress,e,n)}else this.sendFrame(u.frame(r,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:c.readOnly}),n)}dispatch(e,t,n,r){if(!t)return void this.sendFrame(u.frame(e,n),r);const o=this._extensions[i.extensionName];this._deflating=!0,o.compress(e,n.fin,(e,t)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(u.frame(t,n),r),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}e.exports=u},function(e,t,n){"use strict";const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function i(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t=Object.create(null);if(void 0===e||""===e)return t;let n,o,s=Object.create(null),a=!1,c=!1,l=!1,u=-1,h=-1,f=0;for(;f<e.length;f++){const d=e.charCodeAt(f);if(void 0===n)if(-1===h&&1===r[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else{if(59!==d&&44!==d)throw new SyntaxError("Unexpected character at index "+f);{if(-1===u)throw new SyntaxError("Unexpected character at index "+f);-1===h&&(h=f);const r=e.slice(u,h);44===d?(i(t,r,s),s=Object.create(null)):n=r,u=h=-1}}else if(void 0===o)if(-1===h&&1===r[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else if(59===d||44===d){if(-1===u)throw new SyntaxError("Unexpected character at index "+f);-1===h&&(h=f),i(s,e.slice(u,h),!0),44===d&&(i(t,n,s),s=Object.create(null),n=void 0),u=h=-1}else{if(61!==d||-1===u||-1!==h)throw new SyntaxError("Unexpected character at index "+f);o=e.slice(u,f),u=h=-1}else if(c){if(1!==r[d])throw new SyntaxError("Unexpected character at index "+f);-1===u?u=f:a||(a=!0),c=!1}else if(l)if(1===r[d])-1===u&&(u=f);else if(34===d&&-1!==u)l=!1,h=f;else{if(92!==d)throw new SyntaxError("Unexpected character at index "+f);c=!0}else if(34===d&&61===e.charCodeAt(f-1))l=!0;else if(-1===h&&1===r[d])-1===u&&(u=f);else if(-1===u||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError("Unexpected character at index "+f);{if(-1===u)throw new SyntaxError("Unexpected character at index "+f);-1===h&&(h=f);let r=e.slice(u,h);a&&(r=r.replace(/\\/g,""),a=!1),i(s,o,r),44===d&&(i(t,n,s),s=Object.create(null),n=void 0),o=void 0,u=h=-1}}else-1===h&&(h=f)}if(-1===u||l)throw new SyntaxError("Unexpected end of input");-1===h&&(h=f);const d=e.slice(u,h);return void 0===n?i(t,d,s):(void 0===o?i(s,d,!0):i(s,o,a?d.replace(/\\/g,""):d),i(t,n,s)),t}}},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n,r){var i=t&&t.prototype instanceof u?t:u,o=Object.create(i.prototype),s=new k(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return S()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=b(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,s),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=a;var l={};function u(){}function h(){}function f(){}var d={};d[i]=function(){return this};var v=Object.getPrototypeOf,p=v&&v(v(x([])));p&&p!==t&&n.call(p,i)&&(d=p);var g=f.prototype=u.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function m(e){var t;this._invoke=function(r,i){function o(){return new Promise((function(t,o){!function t(r,i,o,s){var a=c(e[r],e,i);if("throw"!==a.type){var l=a.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),(function(e){return t("throw",e,o,s)}))}s(a.arg)}(r,i,t,o)}))}return t=t?t.then(o,o):o()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=g.constructor=f,f.constructor=h,f[s]=h.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(m.prototype),m.prototype[o]=function(){return this},e.AsyncIterator=m,e.async=function(t,n,r,i){var o=new m(a(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(g),g[s]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=i.bind(this)}function i(){this.pending--,this._run()}["push","unshift","splice"].forEach((function(e){r.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}})),Object.defineProperty(r.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),r.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},r.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this._run())},e.exports=r},function(e,t){e.exports=require("zlib")},function(e,t,n){"use strict";(function(t){try{e.exports=n(8)(t)}catch(t){e.exports=n(25)}}).call(this,"/")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";e.exports={mask:(e,t,n,r,i)=>{for(var o=0;o<i;o++)n[r+o]=e[o]^t[3&o]},unmask:(e,t)=>{const n=e.length;for(var r=0;r<n;r++)e[r]^=t[3&r]}}},function(e,t,n){"use strict";(function(t){try{e.exports=n(8)(t)}catch(t){e.exports=n(27)}}).call(this,"/")},function(e,t,n){"use strict";e.exports=e=>{for(var t=e.length,n=0;n<t;)if(e[n]<128)n++;else if(192==(224&e[n])){if(n+1===t||128!=(192&e[n+1])||192==(254&e[n]))return!1;n+=2}else if(224==(240&e[n])){if(n+2>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||224===e[n]&&128==(224&e[n+1])||237===e[n]&&160==(224&e[n+1]))return!1;n+=3}else{if(240!=(248&e[n]))return!1;if(n+3>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||128!=(192&e[n+3])||240===e[n]&&128==(240&e[n+1])||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}},function(e,t,n){"use strict";class r{constructor(e,t){this.target=t,this.type=e}}class i extends r{constructor(e,t){super("message",t),this.data=e}}class o extends r{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}}class s extends r{constructor(e){super("open",e)}}class a extends r{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const c={addEventListener(e,t){function n(e){t.call(this,new i(e,this))}function r(e,n){t.call(this,new o(e,n,this))}function c(e){t.call(this,new a(e,this))}function l(){t.call(this,new s(this))}"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(c._listener=t,this.on(e,c)):"open"===e?(l._listener=t,this.on(e,l)):this.on(e,t))},removeEventListener(e,t){const n=this.listeners(e);for(let r=0;r<n.length;r++)n[r]!==t&&n[r]._listener!==t||this.removeListener(e,n[r])}};e.exports=c},function(e,t,n){"use strict";const{Duplex:r}=n(11);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let n=!0;function a(){n&&e._socket.resume()}e.readyState===e.CONNECTING?e.once("open",(function(){e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a)})):(e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a));const c=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",(function(t){c.push(t)||(n=!1,e._socket.pause())})),e.once("error",(function(e){c.destroy(e)})),e.once("close",(function(){c.destroyed||c.push(null)})),c._destroy=function(t,n){if(e.readyState===e.CLOSED)return n(t),void process.nextTick(i,c);e.once("close",(function(){n(t),process.nextTick(i,c)})),e.terminate()},c._final=function(t){e.readyState!==e.CONNECTING?e._socket._writableState.finished?(c._readableState.endEmitted&&c.destroy(),t()):(e._socket.once("finish",(function(){t()})),e.close()):e.once("open",(function(){c._final(t)}))},c._read=function(){e.readyState!==e.OPEN||n||(n=!0,e._receiver._writableState.needDrain||e._socket.resume())},c._write=function(t,n,r){e.readyState!==e.CONNECTING?e.send(t,r):e.once("open",(function(){c._write(t,n,r)}))},c.on("end",o),c.on("error",s),c}},function(e,t,n){"use strict";const r=n(6),{createHash:i}=n(1),{createServer:o,STATUS_CODES:s}=n(7),a=n(2),c=n(5),{format:l,parse:u}=n(14),{GUID:h}=n(0),f=/^[+/0-9A-Za-z]{22}==$/,d=Symbol("kUsedByWebSocketServer");function v(e){e.emit("close")}function p(){this.destroy()}function g(e,t,n,r){e.writable&&(n=n||s[t],r={Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(n),...r},e.write(`HTTP/1.1 ${t} ${s[t]}\r\n`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)),e.removeListener("error",p),e.destroy()}e.exports=class extends r{constructor(e,t){if(super(),null==(e={maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e}).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');if(null!=e.port)this._server=o((e,t)=>{const n=s[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t);else if(e.server){if(e.server[d])throw new Error("The HTTP/S server is already being used by another WebSocket server");e.server[d]=!0,this._server=e.server}this._server&&(this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,n)=>{this.handleUpgrade(e,t,n,t=>{this.emit("connection",t,e)})}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(const e of this.clients)e.terminate();const t=this._server;if(t){if(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)return void t.close(()=>this.emit("close"));delete t[d]}process.nextTick(v,this)}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",p);const i=void 0!==e.headers["sec-websocket-key"]&&e.headers["sec-websocket-key"].trim(),o=+e.headers["sec-websocket-version"],s={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!i||!f.test(i)||8!==o&&13!==o||!this.shouldHandle(e))return g(t,400);if(this.options.perMessageDeflate){const n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const t=u(e.headers["sec-websocket-extensions"]);t[a.extensionName]&&(n.accept(t[a.extensionName]),s[a.extensionName]=n)}catch(e){return g(t,400)}}if(this.options.verifyClient){const a={origin:e.headers[""+(8===o?"sec-websocket-origin":"origin")],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(a,(o,a,c,l)=>{if(!o)return g(t,a||401,c,l);this.completeUpgrade(i,s,e,t,n,r)});if(!this.options.verifyClient(a))return g(t,401)}this.completeUpgrade(i,s,e,t,n,r)}completeUpgrade(e,t,n,r,o,s){if(!r.readable||!r.writable)return r.destroy();const u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: "+i("sha1").update(e+h).digest("base64")],f=new c(null);let d=n.headers["sec-websocket-protocol"];if(d&&(d=d.trim().split(/ *, */),d=this.options.handleProtocols?this.options.handleProtocols(d,n):d[0],d&&(u.push("Sec-WebSocket-Protocol: "+d),f.protocol=d)),t[a.extensionName]){const e=t[a.extensionName].params,n=l({[a.extensionName]:[e]});u.push("Sec-WebSocket-Extensions: "+n),f._extensions=t}this.emit("headers",u,n),r.write(u.concat("\r\n").join("\r\n")),r.removeListener("error",p),f.setSocket(r,o,this.options.maxPayload),this.clients&&(this.clients.add(f),f.on("close",()=>this.clients.delete(f))),s(f)}}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"LogFile",(function(){return o}));var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.readHandler=null,this.writeHandler=null,this.json=null,"string"==typeof t.path?this.initFileHandler(t.path,t.init):void 0!==t.object&&(this.json=t.object),this.readHandler(),this.watch()}var t,o,s;return t=e,(o=[{key:"watch",value:function(){var e=this,t={get:function(e,t){return Reflect.get(e,t)},set:function(n,i,o){return console.log("set",i),null==(o=Reflect.get(n,i))||"object"!==r(o)||o.isPrototypeOf(Proxy)||(console.log("newLink from set"),Reflect.set(n,i,new Proxy(o,t))),e.writeHandler(),Reflect.set(n,i,o)}},n=new Proxy(this.json,t);this.json=n}},{key:"initFileHandler",value:function(e,t){var r=n(9);this.readHandler=function(){if(!r.existsSync(e)&&"function"==typeof t){var n=t();r.writeFileSync(e,JSON.stringify(n))}var i=r.readFileSync(e);this.json=JSON.parse(i)},this.writeHandler=function(){console.log("file write");var t=JSON.stringify(this.json);r.writeFileSync(e,t)}}}])&&i(t.prototype,o),s&&i(t,s),e}()},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"createGuid",(function(){return d})),n.d(r,"createUniqueGuid",(function(){return v}));var i={};n.r(i),n.d(i,"debug",(function(){return w})),n.d(i,"info",(function(){return _})),n.d(i,"log",(function(){return k})),n.d(i,"warn",(function(){return x})),n.d(i,"error",(function(){return S})),n.d(i,"count",(function(){return E}));var o={};n.r(o),n.d(o,"Color",(function(){return T}));var s={};n.r(s),n.d(s,"cloneGame",(function(){return X})),n.d(s,"getPossibleMoves",(function(){return J})),n.d(s,"sortMovements",(function(){return Z})),n.d(s,"attachSimulator",(function(){return se}));var a={};n.r(a),n.d(a,"NextBrick",(function(){return me})),n.d(a,"StaticNextBrick",(function(){return we})),n.d(a,"EasyNextBrick",(function(){return ke}));var c={};n.r(c),n.d(c,"transmitter",(function(){return Se})),n.d(c,"receiver",(function(){return Ee}));var l={};n.r(l),n.d(l,"logging",(function(){return c}));n(15);var u=u||n(1);function h(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^function(e){if("function"==typeof u.getRandomValues)return u.getRandomValues(e);if("function"==typeof u.randomFillSync)return u.randomFillSync(e);throw new Error("crypto is lacking a method")}(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}var f=[];function d(){var e=h();return-1===f.indexOf(e)&&f.push(f),e}function v(){var e;do{e=h()}while(-1!==f.indexOf(e));return f.push(e),e}var p=!1,g=!0,y=!0,m=!0;function b(){}p=!1,g=!1,y=!1,m=!1;var w=!0===!1?console.debug:b,_=!0===p?console.info:b,k=!0===g?console.log:b,x=!0===y?console.warn:b,S=!0===m?console.error:b,E=console.count;function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.r=t,this.g=n,this.b=r,this.a=i}var t,n,r;return t=e,r=[{key:"Black",value:function(){return new e(0,0,0,1)}}],(n=[{key:"add",value:function(t,n,r,i){return new e(Math.min(255,this.r+t),this.g+n,this.b+r,this.a+i)}},{key:"toRGBAString",value:function(){return"rgba(".concat(parseInt(this.r),",").concat(parseInt(this.g),",").concat(parseInt(this.b),",").concat(parseFloat(this.a),")")}},{key:"toHSLA",value:function(){var e=this.r/255,t=this.g/255,n=this.b/255,r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,s=0,a=0;return s=0==o?0:i==e?(t-n)/o%6:i==t?(n-e)/o+2:(e-t)/o+4,(s=Math.round(60*s))<0&&(s+=360),a=(i+r)/2,{h:s,s:+(100*(0==o?0:o/(1-Math.abs(2*a-1)))).toFixed(1)/100,l:(a=+(100*a).toFixed(1))/100,a:this.a}}},{key:"setInvert",value:function(){return this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this}},{key:"invert",value:function(){return this.copy().setInvert()}},{key:"setAlpha",value:function(e){return this.a=e,this}},{key:"alpha",value:function(e){return this.copy().setAlpha(e)}},{key:"setBrightness",value:function(e){return this.r=this.r*e,this.g=this.g*e,this.b=this.b*e,this}},{key:"brightness",value:function(e){return this.copy().setBrightness(e)}},{key:"setAlphaScale",value:function(e){return this.a=this.a*e,this}},{key:"alphaScale",value:function(e){return this.copy().setAlphaScale(e)}},{key:"setScale",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"scale",value:function(e){return this.copy().setScale(e)}},{key:"copy",value:function(){return new e(this.r,this.g,this.b,this.a)}}])&&O(t.prototype,n),r&&O(t,r),e}();new WeakMap,new WeakMap,new WeakMap;function N(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}function C(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var I=r.createUniqueGuid,P=new WeakMap,W=new WeakMap,A=new WeakMap,j=new WeakMap,U=new WeakMap,R=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:0}),j.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0});var n=t||{ingame:!1,game:null};"string"==typeof n.guid?C(this,U,n.guid):C(this,U,I()),this.game=n.game,this.ingame=n.ingame,null!=n.brickform&&(null!=this.game&&(this.color=this.game.getColors()[0].copy()),this.blocks=n.brickform.concat()),"number"==typeof n.x&&"number"==typeof n.y&&(this.x=n.x,this.y=n.y)}var t,n,r;return t=e,r=[{key:"calcAbsoluteBlocks",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=[],s=t+r,a=n+i;for(var c in e)for(var l in e[c])1==e[c][l]&&o.push({x:s+parseInt(l),y:a+parseInt(c)});return o}},{key:"calcHeight",value:function(e){var t=0;for(var n in e)for(var r in e[n])1==e[n][r]&&(t=Math.max(t,parseInt(n)+1));return t}},{key:"calcWidth",value:function(e){var t=0,n=Infinity;for(var r in e)for(var i in e[r])1==e[r][i]&&(t=Math.max(t,parseInt(i)+2),n=Math.min(n,parseInt(i)+2));return t-n+1}},{key:"calcBlockX",value:function(e){for(var t=0,n=0,r=0;r<4;r++){for(var i in t=0,e)0==e[i][r]&&t++;if(t!=e.length)return n;n++}}},{key:"calcRotatedBlocks",value:function(e){for(var t=[],n=e[0].length,r=e.length,i=0;i<r;i++){for(var o=[],s=0;s<n;s++)o[s]=e[n-s-1][i];t[i]=o}return t}},{key:"calcValidPosition_xOutRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;if(n+i+r+e>o.width){if(!0===t)throw new Error("The brick would be out of bounds");return!1}return!0}},{key:"calcValidPosition_xOutLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n+r+e<0){if(!0===t)throw new Error("The brick would be out of bounds");return!1}return!0}},{key:"calcValidPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,u=e.calcBlockX(s);if(!e.calcValidPosition_xOutLeft(t,r,i,u,c))return!1;var h=e.calcWidth(s);if(!e.calcValidPosition_xOutRight(t,r,i,u,h,c))return!1;if(o+e.calcHeight(s)+n>c.height){if(!0===r)throw new Error("The brick would be out of bounds");return!1}if(e.calcWillCollide(t,n,a,s,i,o,l)){if(!0===r)throw new Error("The brick would collide with another brick");return!1}return!0}},{key:"calcMostLeft",value:function(t){return parseInt(-e.calcBlockX(t))}},{key:"calcMostRight",value:function(t,n){return parseInt(t.width-e.calcWidth(n)-e.calcBlockX(n))}},{key:"calcWillCollide",value:function(t,n,r,i,o,s,a){var c,l=e.calcAbsoluteBlocks(i,o,s,t,n),u=N(r);try{for(u.s();!(c=u.n()).done;){var h=c.value;if(h.guid!==a){var f,d=h.getAbsoluteBlocks(),v=N(l);try{for(v.s();!(f=v.n()).done;){var p,g=f.value,y=N(d);try{for(y.s();!(p=y.n()).done;){var m=p.value;if(m.x===g.x&&m.y===g.y)return!0}}catch(e){y.e(e)}finally{y.f()}}}catch(e){v.e(e)}finally{v.f()}}}}catch(e){u.e(e)}finally{u.f()}return!1}},{key:"calcLowestPosition",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=e.calcHeight(t),c=0;!(o+c+a>r.height||e.calcWillCollide(n,c,r.bricks,t,i,o,s));)c++;return o+c-1}}],(n=[{key:"clone",value:function(){var t=new e({guid:B(this,U)});return C(t,P,B(this,P)),C(t,W,B(this,W)),t.moving=this.moving,t.blocks=this.blocks.concat(),t.color=this.color.copy(),C(t,A,B(this,A)),t.index=this.index,t}},{key:"requestUpdate",value:function(){this.ingame&&null!=this.game&&(this.game.PENDINGUPDATE=!0)}},{key:"resetPosition",value:function(){this.x=Math.round(this.game.width/2-this.blocks[0].length/2),this.y=Math.round(0-this.blocks.length)}},{key:"getAbsoluteBlocks",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return null==t&&(t=this.blocks),e.calcAbsoluteBlocks(t,this.x,this.y,n,r)}},{key:"checkCollision",value:function(e,t,n){for(var r in n)for(var i in n[r].blocks)for(var o in n[r].blocks[i])if(1==n[r].blocks[i][o]){var s=e==n[r].x+parseInt(o),a=t==n[r].y+parseInt(i),c=this!=n[r];if(s&&a&&c)return!1}return!0}},{key:"getHeight",value:function(){return e.calcHeight(this.blocks)}},{key:"getWidth",value:function(){return e.calcWidth(this.blocks)}},{key:"getBlockY",value:function(){var e=0,t=0;for(var n in this.blocks){for(var r in this.blocks[n])0==this.blocks[n][r]&&e++;if(e!=this.blocks[0].length)return t;t++}}},{key:"getBlockX",value:function(){return e.calcBlockX(this.blocks)}},{key:"rotate_okay",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.calcValidPosition(0,0,r,t.x,t.y,n,this.game.bricks,this.game,this.guid)}},{key:"getRotatedBlocks",value:function(){return e.calcRotatedBlocks(this.blocks)}},{key:"canRotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.rotate_okay(this,t||this.getRotatedBlocks(),e)}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){var n=this.getRotatedBlocks();if(this.canRotate(t,n))this.requestUpdate();else{e.emulate(n);var r=e.calcBlockX(n),i=e.calcWidth(n);if(e.calcValidPosition_xOutRight(0,!1,this.x,r,i,this.game)){if(e.calcValidPosition_xOutLeft(0,!1,this.x,r,this.game))return!1;if(this.x++,!this.rotate_okay(this,n))return this.x--,!1;this.requestUpdate()}else{if(this.x--,!this.rotate_okay(this,n))return this.x++,!1;this.requestUpdate()}}this.blocks=n,C(this,A,(B(this,A)+1)%4)}}},{key:"posInfo",value:function(){return[["x",this.x],["y",this.y],["rotation",B(this,A)]].map((function(e){return e.join(":")})).join(",")}},{key:"validatePosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return"number"!=typeof i&&(i=this.x),"number"!=typeof o&&(o=this.y),e.calcValidPosition(t,n,r,i,o,this.blocks,this.game.bricks,this.game,this.guid)}},{key:"canMoveLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===e)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===e)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(-1,0,e)}},{key:"moveleft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamemove"),this.canMoveLeft(e))return this.x--,!0;if(!0===e)throw new Error("Unknown reason");return!1}if(!0===e)throw new Error("The game is not running");return i.debug("did not move right: out of conditions"),!1}},{key:"willCollide",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return null==i&&(i=this.blocks),null==r&&(r=this.game.bricks),e.calcWillCollide(t,n,r,i,this.x,this.y,this.guid)}},{key:"canMoveRight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===e)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===e)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(1,0,e)}},{key:"moveright",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamemove"),this.canMoveRight(e))return this.x++,!0;if(!0===e)throw new Error("Unknown reason");return!1}if(!0===e)throw new Error("The game is not running");return i.debug("did not move right: out of conditions"),!1}},{key:"canSmashDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===e)throw new Error("The game is not running");return!1}return!0}},{key:"smashdown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.canSmashDown(e))if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamebump"),this.moving=!1,this.y=this.getLowestPosition(),this.requestUpdate(),this.y+this.getBlockY()>=0){var t=this.slice_up();for(var n in this.game.bricks.splice(this.findMe(),1),t)this.game.bricks.push(t[n]);this.game.checkLines(),this.game.addNewBrick(),this.game.HOLDINGCOUNT=0}else this.game.loseView(),!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamelose")}},{key:"canMoveDown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===e)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===e)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(0,1,e)}},{key:"movedown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running&&this.moving)if(this.canMoveDown(e))this.y++;else if(this.moving=!1,!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamebump"),this.y+this.getBlockY()>=0){var t=this.slice_up();for(var n in this.game.bricks.splice(this.findMe(),1),t)this.game.bricks.push(t[n]);this.game.checkLines(),this.game.addNewBrick(),this.game.HOLDINGCOUNT=0}else this.game.loseView(),!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamelose")}},{key:"getLowestPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e.calcLowestPosition(this.blocks,t,this.game,this.x,this.y,this.guid)}},{key:"slice_up",value:function(){var t,n,r,i,o=[],s=this.color;for(var a in this.blocks)for(var c in this.blocks[a])1==this.blocks[a][c]&&o.push((t=parseInt(c)+this.x,n=parseInt(a)+this.y,r=this,i=void 0,(i=new e).moving=!1,i.blocks=[[1]],i.color=s,i.x=t,i.y=n,i.id=r.id,i.index=r.index,i));return o}},{key:"findMe",value:function(){for(var e in this.game.bricks)if(this.game.bricks[e]==this)return e;return i.warn("findMe could not find brick in game"),-1}},{key:"guid",get:function(){return B(this,U)}},{key:"index",get:function(){return B(this,j)},set:function(e){C(this,j,e)}},{key:"x",get:function(){return B(this,P)},set:function(e){C(this,P,e),this.requestUpdate()}},{key:"y",get:function(){return B(this,W)},set:function(e){C(this,W,e),this.requestUpdate()}},{key:"containerWidth",get:function(){return this.blocks[0].length}},{key:"containerHeight",get:function(){return this.blocks.length}},{key:"rotation",get:function(){return B(this,A)},set:function(e){for(var t=B(this,A);t<=e;t++)this.rotate();C(this,A,e)}},{key:"innerX",get:function(){return this.x-this.getBlockX()}},{key:"innerXfar",get:function(){return this.innerX+this.innerWidth}},{key:"mostLeft",get:function(){return calcMostLeft(this.blocks)}},{key:"mostRight",get:function(){return calcMostRight(this.game,this.blocks)}},{key:"innerWidth",get:function(){return this.getWidth()}}])&&M(t.prototype,n),r&&M(t,r),e}();function D(e){!function t(){!0!==e.setup.clickTick&&function(e){var t=e.getMovingBrick();null!=t&&t.movedown(),e.runEvent("tick",null)}(e),setTimeout(t,e.movingSpeed)}()}function G(e,t){var n=function(e){for(var t=0,n=e.length-1;n>=0;n--)0===e[n].filter((function(e){return!0!==e})).length&&t++;return t}(t);return{holes:function(e,t){for(var n=0,r=0;r<e.width;r++)for(var i=!1,o=t.length-1;o>=0;o--)!0===t[o][r]&&1!=i&&(i=!0),!0===i&&!0!==t[o][r]&&t.map((function(e){return e[r]})).slice(0,o).filter((function(e){return e})).length>0&&n++;return n}(e,t),height:function(e,t){for(var n=0,r=0;r<e.width;r++){for(var i=0,o=t.length-1;o>=0;o--)if(!0===t[o][r]){var s=t.length-o;i<s&&(i=s)}n+=i}return n}(e,t),clearingLines:n}}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}function H(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function V(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}R.emulate=function(e){var t=new R({ingame:!1,game:null});return t.moving=!1,t.blocks=e,t};var Y=o.Color;function X(e,t){var n={bricks:e.bricks.concat().map((function(e){return e.clone()}))};null!=e.HOLDING&&(n.holding=e.HOLDING.clone());var r=Object.assign({},e.setup,t,{brickforms:e.setup.brickforms,width:e.setup.width,height:e.setup.height,sequence:e.setup.sequence}),i=new wt(r,n);return i.brickforms=e.brickforms,i.HOLDINGCOUNT=e.HOLDINGCOUNT,i}function z(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(e.width,[]),r=e.getMovingBrick(),i=0;i<4;i++){for(var o=r.blocks,s=0;s<i;s++)o=R.calcRotatedBlocks(r.blocks);for(var a=R.calcMostLeft(o),c=R.calcMostRight(e,o),l=a;l<=c;l++){var u=R.calcLowestPosition(o,l-r.x,e,r.x,r.y,r.guid),h=e.renderBrickMatrix([{guid:r.guid,x:l,y:u,blocks:o}]);n.push({x:l,y:u,brickMatrix:h,rotation:i,needsHolding:t})}}return n}function J(e,t){var n,r,o=[],s=V(z(e,!1,t));try{for(s.s();!(n=s.n()).done;){var a=n.value;o.push(a)}}catch(e){s.e(e)}finally{s.f()}if(e.canUseHolding){var c=X(e,t);c.holdingShift();var l,u=V(z(c,!0,t));try{for(u.s();!(l=u.n()).done;){a=l.value;o.push(a)}}catch(e){u.e(e)}finally{u.f()}}for(var h=0,f=o;h<f.length;h++){var d=f[h],v=d.brickMatrix;d.score=0,d.scores=G(e,v),d.score=3*(r=d.scores).clearingLines+-7*r.holes+-2*r.height+(0==r.holes?2:0)}return o=Z(o),i.debug("POSITIONS",o),o}function Z(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t){return function(n,r){return e(t?r:n)-e(t?n:r)}};return{sorters:[n(e,t)],thenBy:function(e,t){return this.sorters.push(n(e,t)),this},compare:function(e,t){var n,r=V(this.sorters);try{for(r.s();!(n=r.n()).done;){var i=(0,n.value)(e,t);if(0!==i)return i}}catch(e){r.e(e)}finally{r.f()}return 0},execute:function(e){var t=this;return e.concat().sort((function(e,n){return t.compare(e,n)}))}}}((function(e){return e.score}),!0).execute(e)}var K=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K.set(this,{writable:!0,value:void 0}),Q.set(this,{writable:!0,value:[]}),ee.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:!1}),ne.set(this,{writable:!0,value:"assist"}),re.set(this,{writable:!0,value:[]}),ie.set(this,{writable:!0,value:0})}var t,n,r;return t=e,(n=[{key:"attach",value:function(e){H(this,ee,e)}},{key:"drawMovements",value:function(){var e=this;if(q(this,Q).length>0){var t=q(this,Q)[0].brick;i.debug("drawing",t);var n=new Y(255,255,255,.2);setTimeout((function(){return q(e,ee).drawBrick(t,n)}),50)}}},{key:"cancel",value:function(){H(this,te,!0)}},{key:"start",value:function(){var e=this;H(this,ie,(new Date).getTime()),!0===q(this,ee).setup.clickTick?(q(this,ee).ghostDrawing=!1,q(this,ee).addEvent("tick",(function(){!1===e.isCancelled&&(e.tick(),e.drawMovements())}))):setTimeout((function t(){!1===e.isCancelled&&(e.tick(),setTimeout(t,e.getTimeout()))}),0),q(this,ee).addEvent("lose",(function(){e.cancel()}))}},{key:"getTimeout",value:function(){return 100}},{key:"setMode",value:function(e){H(this,ne,e)}},{key:"setSimulation",value:function(e){H(this,re,JSON.parse(JSON.stringify(e)))}},{key:"tick",value:function(){if(!0===q(this,ee).running)if("assist"===q(this,ne))this.assistTick();else{if("playback"!==q(this,ne))throw new Error("Mode is not supported: "+q(this,ne));this.playbackTick()}}},{key:"assistTick",value:function(){var e=q(this,ee).getMovingBrick();0!==q(this,Q).length&&q(this,K)==e||(i.debug("new brick",0===q(this,Q).length,q(this,K)!=e),H(this,Q,J(q(this,ee),{nextBrick:new we(0)})),H(this,K,e)),i.debug(q(this,Q)[0].score),!0===q(this,Q)[0].needsHolding?(q(this,ee).holdingShift(),q(this,Q)[0].needsHolding=!1):q(this,ee).moveTowards(q(this,Q)[0].x,q(this,Q)[0].rotation),i.debug("move",q(this,Q)[0].x)}},{key:"playbackTick",value:function(){var e=(new Date).getTime()-q(this,ie),t=q(this,re).filter((function(t){return!0!==t.done&&t.time<e}));i.log(t);var n,r=V(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;"nextRandom"===o.type?q(this,ee).nextRandom=o.val:"smashdown"===o.type&&q(this,ee).action_smashdown(),q(this,ee).PENDINGUPDATE=!0,o.done=!0}}catch(e){r.e(e)}finally{r.f()}}},{key:"isCancelled",get:function(){return q(this,te)}}])&&F(t.prototype,n),r&&F(t,r),e}();function se(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new oe;return n.attach(e),Array.isArray(e.setup.simulation)&&(n.setMode("playback"),n.setSimulation(e.setup.simulation)),!0===t&&n.start(),n}function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=de(e);if(t){var i=de(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return he(this,n)}}function he(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?fe(e):t}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e,t,n){return t&&ge(e.prototype,t),n&&ge(e,n),e}var me=function(){function e(){pe(this,e)}return ye(e,[{key:"nextBrick",value:function(e){for(var t=e.nextRandom,n=t;n===t;)n=Math.round(Math.random()*(e.brickforms.length-1));return n}}]),e}(),be=new WeakMap,we=function(e){ce(n,e);var t=ue(n);function n(e){var r;return pe(this,n),r=t.call(this),be.set(fe(r),{writable:!0,value:void 0}),ve(fe(r),be,e),r}return ye(n,[{key:"nextBrick",value:function(){return function(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}(this,be)}}]),n}(me),_e=new WeakMap,ke=function(e){ce(n,e);var t=ue(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return pe(this,n),e=t.call(this),_e.set(fe(e),{writable:!0,value:void 0}),ve(fe(e),_e,r||new me),e}return ye(n,[{key:"nextBrick",value:function(e){for(var t=e.bricks.concat().sort((function(e,t){return t.id-e.id}))[0],n=[],r=0;r<e.brickforms.length;r++)if(null==t||r!=t.index){var i=this.getPossibleMovesForType(e,r)[0];n.push({i:r,move:i})}var o=Z(n)[0];return console.log(o.move.brick.game.nextBrick),o.move.brick.index}},{key:"getPossibleMovesForType",value:function(e,t){var n={};n.nextBrick=new we(t);var r=X(e,n);return r.addNewBrick(),J(r)}}]),n}(me);function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(){var e=new(n(4))("ws://127.0.0.1:8085",{});e.on("open",(function(){console.log("socket open"),e.send(JSON.stringify({action:"log",time:(new Date).getTime(),gameGuid:1337,data:{text:"foo"}}))})),e.on("message",(function(){console.log("got message")})),e.on("close",(function(){console.log("close")})),e.on("error",(function(){console.log("error")}))}function Ee(){var e=new(0,n(31).LogFile)({path:"./log.json",init:function(){return[]}}),t=n(4);console.log("init"),new t.Server({port:8085}).on("connection",(function(t){console.log("connection"),t.on("message",(function(n){try{n=JSON.parse(n)}catch(e){return t.close(),void console.error(e)}if("object"!==xe(n)||null==n||Array.isArray(n))t.close();else if("log"===n.action){var r=e.json.filter((function(e){return null!=e&&e.gameGuid===n.data.gameGuid}))[0];return null==r&&((r={}).gameGuid=n.data.gameGuid,r.events=[],e.json.push(r)),void r.events.push({data:n.data,time:n.time})}}))}))}function Oe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Te(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}var Me=new WeakMap,Be=new WeakMap,Ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Me.set(this,{writable:!0,value:[]}),Be.set(this,{writable:!0,value:null}),function(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,Be,t)}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){Le(this,Me).push({name:e,handler:t})}},{key:"trigger",value:function(e,t){null===t&&(t=Le(this,Be));for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o,s=Oe(Le(this,Me));try{for(s.s();!(o=s.n()).done;){var a=o.value;a.name===e&&a.handler.apply(t,r)}}catch(e){s.e(e)}finally{s.f()}}}])&&Ne(t.prototype,n),r&&Ne(t,r),e}();function Ie(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}var je="after-init",Ue=new WeakMap,Re=new WeakMap,De=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ue.set(this,{writable:!0,value:[]}),Re.set(this,{writable:!0,value:[]})}var t,n,r;return t=e,(n=[{key:"add",value:function(e,t,n){var r;switch(n){case je:r={initType:n,object:e,callback:t,loaded:!1};break;default:throw new Error("Unknown INIT_TYPE: "+n)}Ae(this,Ue).push(r),this.typeIsAlreadyLoaded(n)&&this.loadAddon(r)}},{key:"typeIsAlreadyLoaded",value:function(e){return-1!==Ae(this,Re).indexOf(e)}},{key:"loadByType",value:function(e){if(this.typeIsAlreadyLoaded(e))throw new Error("Type "+e+" has already been loaded");Ae(this,Re).push(e);var t,n=Ie(Ae(this,Ue));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.initType===e&&!1===r.loaded&&this.loadAddon(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"loadAddon",value:function(e){if(!1!==e.loaded)throw new Error("Addon is already loaded");e.loaded=!0,e.callback(e.object)}}])&&We(t.prototype,n),r&&We(t,r),e}();function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $e(e,t,n){return t&&Ve(e.prototype,t),n&&Ve(e,n),e}function Ye(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function Xe(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}var ze=s.attachSimulator,Je=o.Color,Ze=c.transmitter,Ke=a.NextBrick,Qe=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,it=new WeakMap,ot=new WeakMap,st=new WeakMap,at=new WeakMap,ct=new WeakMap,lt=new WeakMap,ut=new WeakMap,ht=new WeakMap,ft=new WeakMap,dt=new WeakMap,vt=new WeakMap,pt=new WeakMap,gt=new WeakMap,yt=new WeakMap,mt=new WeakMap,bt=new WeakMap,wt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(He(this,e),Qe.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),tt.set(this,{writable:!0,value:!0}),nt.set(this,{writable:!0,value:null}),rt.set(this,{writable:!0,value:!1}),it.set(this,{writable:!0,value:0}),ot.set(this,{writable:!0,value:void 0}),st.set(this,{writable:!0,value:-1}),at.set(this,{writable:!0,value:void 0}),ct.set(this,{writable:!0,value:[]}),lt.set(this,{writable:!0,value:void 0}),ut.set(this,{writable:!0,value:void 0}),ht.set(this,{writable:!0,value:new Ce(this)}),ft.set(this,{writable:!0,value:new De}),dt.set(this,{writable:!0,value:!0}),vt.set(this,{writable:!0,value:null}),pt.set(this,{writable:!0,value:void 0}),gt.set(this,{writable:!0,value:[]}),yt.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),bt.set(this,{writable:!0,value:0}),Ye(this,lt,t),Ye(this,mt,t.nextBrick||new Ke),Ye(this,yt,i),null!=Xe(this,yt)&&Xe(this,yt).setGame(this),!0===t.logger&&this.addLogEntry({name:"gameInit"}),Ye(this,Qe,t.width),Ye(this,et,t.height),Ye(this,pt,Math.round(1e16*Math.random())),Ye(this,ut,new Je(0,255,0,.5)),null!=r){if(Array.isArray(r.bricks)){Ye(this,ct,r.bricks.concat());var o,s=Fe(Xe(this,ct));try{for(s.s();!(o=s.n()).done;){var a=o.value;a.game=this}}catch(e){s.e(e)}finally{s.f()}}null!=r.holding&&(Ye(this,nt,r.holding),Xe(this,nt).game=this)}this.brickforms=t.brickforms;var c=[new Je(255,0,0,1),new Je(0,255,0,1),new Je(0,0,255,1),new Je(255,255,0,1),new Je(0,255,255,1),new Je(255,0,255,1),new Je(0,128,128,1)];this.setNextRandom();var l=this;function u(e){var t=this;if(Xe(this,dt)){this.score++,this.runEvent("fx",null,"sound","gamerow");var n=l.bricks;!function(e){var r=0;for(r=0;r<=t.width;r++)for(var i in n)for(var o in n[i].blocks)for(var s in n[i].blocks[o])if(1==n[i].blocks[o][s]){var a=e==n[i].y+parseInt(o),c=0==n[i].moving;a&&c&&n.splice(parseInt(i),1)}}(e),function(e){for(var t in n)for(var r in n[t].blocks)for(var i in n[t].blocks[r])if(1==n[t].blocks[r][i]){var o=e>n[t].y+parseInt(r),s=0==n[t].moving;o&&s&&n[t].y++}}(e)}}this.getColors=function(){return c},this.checkLines=function(){if(Xe(n,dt)){for(var e,t=n.height;t>1;t--){var r=0;for(e=0;e<=n.width-1;e++)n.checkXY(e,t)&&r++;r==n.width&&u.call(n,t++)}n.PENDINGUPDATE=!0}},this.init=function(){if(Ye(this,dt,!0),this.score=0,this.HOLDINGCOUNT=0,this.addNewBrick(),D(this),!0===this.setup.simulator&&ze(this),!0===this.setup.logger){var e=Ze(),t=this;setInterval((function(){if(null!=Xe(t,vt)&&Xe(t,vt).readyState===Xe(t,vt).OPEN)for(var e;(e=Xe(t,gt).splice(0,1)).length>0;){var n,r=Fe(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;Xe(t,vt).send(JSON.stringify(i))}}catch(e){r.e(e)}finally{r.f()}}})),Ye(this,vt,e)}Xe(this,yt).initializeInput(),Xe(this,yt).initRender(),Xe(this,ft).loadByType(je)}}return $e(e,[{key:"registerAddon",value:function(e,t,n){var r=this;Xe(this,ft).add(e,(function(e){return t(e,r)}),n)}},{key:"gridColor",get:function(){return Xe(this,ut)}}]),$e(e,[{key:"renderBrickMatrix",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[],r=0;r<this.height;r++){n.push([]);for(var i=0;i<this.width;i++)n[n.length-1].push(!1)}var o,s=this.bricks,a=Fe(s);try{var c=function(){var s=o.value;for(h in l=s.blocks,i=s.x,r=s.y,null!=(u=t.filter((function(e){return e.guid==s.guid}))[0])&&("number"==typeof u.x&&(i=u.x),"number"==typeof u.y&&(r=u.y),void 0!==u.blocks&&(l=u.blocks)),l)for(f in l[h])if(1==l[h][f]){if(d=i+parseInt(f),(v=r+parseInt(h))<0)continue;if(v>e.height)continue;n[v][d]=!0}};for(a.s();!(o=a.n()).done;){var l,u,h,f,d,v;c()}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"getBrickId",value:function(){return(this.bricks.length>0?this.bricks.map((function(e){return e.id})).sort((function(e,t){return t-e}))[0]:0)+1}},{key:"addNewBrick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=new R({game:this,ingame:!0});t.id=this.getBrickId();var n=this.brickforms,r=this.nextRandom;t.color=this.getColors()[r].copy(),t.blocks=n[r].concat(),t.index=r,t.moving=!0,t.resetPosition(),this.logEvent({name:"newBrick",blocks:t.blocks}),this.setNextRandom(),-1===e?this.bricks.push(t):this.bricks[e]=t}},{key:"logEvent",value:function(e){if(!0===this.setup.logger){var t=Xe(this,pt),n={action:"log",time:(new Date).getTime(),data:Object.assign({gameGuid:t},e)};this.addLogEntry(n)}}},{key:"addLogEntry",value:function(e){Xe(this,gt).push(e)}},{key:"holdingShift",value:function(){if(this.canUseHolding)if(null==Xe(this,nt))Ye(this,nt,this.getMovingBrick()),this.addNewBrick(this.getMovingBrick().findMe()),this.HOLDINGCOUNT++;else{var e=Xe(this,nt);Ye(this,nt,this.getMovingBrick()),e.resetPosition(),this.bricks[this.getMovingBrick().findMe()]=e,this.HOLDINGCOUNT++}}},{key:"getMovingBrick",value:function(){for(var e in this.bricks)if(this.bricks[e].moving)return this.bricks[e]}},{key:"clone",value:function(){return new e}},{key:"action_smashdown",value:function(){this.getMovingBrick().smashdown(!0)}},{key:"action_moveleft",value:function(){this.getMovingBrick().moveleft()}},{key:"action_rotate",value:function(){this.getMovingBrick().rotate()}},{key:"action_moveright",value:function(){this.getMovingBrick().moveright()}},{key:"action_movedown",value:function(){this.getMovingBrick().movedown()}},{key:"setNextRandom",value:function(){Array.isArray(this.setup.sequence)?(Ye(this,st,(Xe(this,st)+1)%this.setup.sequence.length),this.nextRandom=this.setup.sequence[Xe(this,st)]):this.nextRandom=Xe(this,mt).nextBrick(this)}},{key:"checkXY",value:function(e,t){var n,r=Fe(this.bricks);try{for(r.s();!(n=r.n()).done;)for(var i=n.value,o=0,s=i.blocks.length;o<s;o++)for(var a=0,c=i.blocks[o].length;a<c;a++)if(1==i.blocks[o][a]){var l=e==i.x+parseInt(a),u=t==i.y+parseInt(o),h=0==i.moving;if(l&&u&&h)return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"moveTowards",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.debug("moving to",e,t);var n=this.getMovingBrick();if("number"==typeof t&&t!=this.getMovingBrick().rotation)return i.debug("rotating from "+this.getMovingBrick().rotation+" to "+t),void this.action_rotate();n.x>e?(i.debug("left"),this.action_moveleft()):n.x<e?(i.debug("right"),this.action_moveright()):(i.debug("down"),this.action_smashdown())}},{key:"addEvent",value:function(e,t){Xe(this,ht).on(e,t)}},{key:"runEvent",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];Xe(this,ht).trigger.apply(Xe(this,ht),[e,t].concat(r))}},{key:"loseView",value:function(){this.runEvent("fx",null,"sound","gamelose"),Ye(this,dt,!1),Xe(this,ht).trigger("lose",null),!0===this.setup.simulator&&setTimeout((function(){return window.location.reload()}),2e3)}},{key:"score",get:function(){return Xe(this,bt)},set:function(e){Ye(this,bt,e),Xe(this,ht).trigger("update-score",null,e)}},{key:"colors",get:function(){return this.getColors()}},{key:"holding",get:function(){return Xe(this,nt)},set:function(e){Ye(this,nt,e)}},{key:"movingSpeed",get:function(){return 1e3}},{key:"canUseHolding",get:function(){return this.HOLDINGCOUNT<1}},{key:"ghostDrawing",get:function(){return Xe(this,tt)},set:function(e){Ye(this,tt,e)}},{key:"brickforms",get:function(){return Xe(this,at)},set:function(e){Ye(this,at,e)}},{key:"HOLDING",get:function(){return Xe(this,nt)}},{key:"HOLDINGCOUNT",get:function(){return Xe(this,it)},set:function(e){Ye(this,it,e)}},{key:"PENDINGUPDATE",get:function(){return Xe(this,rt)},set:function(e){return Ye(this,rt,e)}},{key:"nextRandom",get:function(){return Xe(this,ot)},set:function(e){Ye(this,ot,e)}},{key:"running",get:function(){return Xe(this,dt)}},{key:"width",get:function(){return Xe(this,Qe)}},{key:"height",get:function(){return Xe(this,et)}},{key:"bricks",get:function(){return Xe(this,ct)},set:function(e){if(""!=e||"object"!=Ge([]))return!1;this.score=0,this.HOLDINGCOUNT=0,Ye(this,nt,null),Ye(this,ct,[])}},{key:"setup",get:function(){return Xe(this,lt)}}]),e}();new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap;var _t=l.logging,kt=_t.receiver,xt=_t.transmitter;process.argv.filter((function(e){return"--test"===e})).length>0?xt():kt()}]);