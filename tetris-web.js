var tetris=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";function r(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return u=t.done,t},e:function(t){s=!0,a=t},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function s(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function c(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}n.d(e,"a",(function(){return h}));var l=new WeakMap,f=new WeakMap,h=function(){function t(e){o(this,t),l.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:[]}),c(this,l,this.parse(e))}return u(t,[{key:"parse",value:function(e){return e instanceof t?this.parse(s(e,l)):"string"==typeof e?-1!==(e=e.trim()).indexOf("<")?t.stringToElement(e):document.createElement(e):e}},{key:"querySelector",value:function(e){return new t(s(this,l).querySelector(e))}},{key:"attr",value:function(t,e){return 1==arguments.length?s(this,l).getAttribute(t):(s(this,l).setAttribute(t,e),this)}},{key:"append",value:function(e){if(Array.isArray(e)){var n,i=r(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;this.append(o)}}catch(t){i.e(t)}finally{i.f()}}else e instanceof t?s(this,l).appendChild(s(e,l)):s(this,l).appendChild(this.parse(e));return this}},{key:"toString",value:function(){return s(this,l).outerHTML}},{key:"text",value:function(t){return 0===arguments.length?s(this,l).textContent:(s(this,l).textContent=t,this)}},{key:"el",get:function(){return s(this,l)}},{key:"react",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new m(t);return s(this,f).push(n),!0===e&&n.observe(),n}}],[{key:"stringToElement",value:function(t,e){var n=document.createElement(e||"div");n.innerHTML=t;for(var r=[],i=0;i<n.children.length;i++)r.push(n.children[i]);return 1===r.length?r[0]:r}}]),t}(),v=new WeakMap,d=new WeakMap,g=new WeakMap,p=new WeakMap,y=new WeakMap,m=function(){function t(e){o(this,t),v.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:-1}),g.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:[]}),c(this,v,e),c(this,g,function(){var t=this.getCurrentValue();t!==this.lastValue&&(this.lastValue=t,this.emit())}.bind(this))}return u(t,[{key:"lastValue",get:function(){return s(this,p)},set:function(t){c(this,p,t)}},{key:"emit",value:function(){var t,e=r(s(this,y));try{for(e.s();!(t=e.n()).done;){var n=t.value;this.invoke(n)}}catch(t){e.e(t)}finally{e.f()}}},{key:"addHandler",value:function(t){return s(this,y).push(t),this}},{key:"invoke",value:function(t){t(this.lastValue)}},{key:"getCurrentValue",value:function(){return s(this,v).call(this)}},{key:"observe",value:function(){if(-1!==s(this,d))throw new Error("Is already observing");c(this,d,setInterval(s(this,g),100))}}]),t}()},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(e),n.d(e,"Color",(function(){return i}));var i=function(){function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=e,this.g=n,this.b=r,this.a=i}var e,n,i;return e=t,i=[{key:"Black",value:function(){return new t(0,0,0,1)}}],(n=[{key:"add",value:function(e,n,r,i){return new t(Math.min(255,this.r+e),this.g+n,this.b+r,this.a+i)}},{key:"toRGBAString",value:function(){return"rgba(".concat(parseInt(this.r),",").concat(parseInt(this.g),",").concat(parseInt(this.b),",").concat(parseFloat(this.a),")")}},{key:"toHSLA",value:function(){var t=this.r/255,e=this.g/255,n=this.b/255,r=Math.min(t,e,n),i=Math.max(t,e,n),o=i-r,a=0,u=0;return a=0==o?0:i==t?(e-n)/o%6:i==e?(n-t)/o+2:(t-e)/o+4,(a=Math.round(60*a))<0&&(a+=360),u=(i+r)/2,{h:a,s:+(100*(0==o?0:o/(1-Math.abs(2*u-1)))).toFixed(1)/100,l:(u=+(100*u).toFixed(1))/100,a:this.a}}},{key:"setInvert",value:function(){return this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this}},{key:"invert",value:function(){return this.copy().setInvert()}},{key:"setAlpha",value:function(t){return this.a=t,this}},{key:"alpha",value:function(t){return this.copy().setAlpha(t)}},{key:"setBrightness",value:function(t){return this.r=this.r*t,this.g=this.g*t,this.b=this.b*t,this}},{key:"brightness",value:function(t){return this.copy().setBrightness(t)}},{key:"setAlphaScale",value:function(t){return this.a=this.a*t,this}},{key:"alphaScale",value:function(t){return this.copy().setAlphaScale(t)}},{key:"setScale",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this}},{key:"scale",value:function(t){return this.copy().setScale(t)}},{key:"copy",value:function(){return new t(this.r,this.g,this.b,this.a)}}])&&r(e.prototype,n),i&&r(e,i),t}()},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(a=r,u=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(u),"/*# ".concat(s," */")),o=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([i]).join("\n")}var a,u,s;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var u=0;u<t.length;u++){var s=[].concat(t[u]);r&&i[s[0]]||(n&&(s[2]?s[2]="".concat(n," and ").concat(s[2]):s[2]=n),e.push(s))}},e}},function(t,e){t.exports='<div class="tetris-logo"></div>\n<p class="scorelbl">Score: <span id="score" data-target="score">0</span></p>\n<div class="screen">\n    <div class="holding">\n        <p>Hold:</p><canvas id="holding" data-target="holdingCanvas"></canvas>\n    </div>\n    <div class="game-canvas-container">\n        <canvas id="game" data-target="gameCanvas"></canvas>\n    </div>\n    <div class="next">\n        <p>Next:</p><canvas id="next" data-target="nextCanvas"></canvas>\n    </div>\n</div>'},function(t,e){t.exports='<div>\n    <div>\n        <input type="checkbox" data-target="clickTick"> ClickTick\n    </div>\n    <div data-target="simulation-viewer">\n        <input type="range" min="-1" max="-1" value="-1" data-target="simulationSelector">\n        <button data-target="sim-down">&lt;</button>\n        <button data-target="sim-up">&gt;</button>\n    </div>\n</div>'},function(t,e,n){var r=n(6),i=n(7);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){"use strict";var r,i=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function u(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function s(t,e){for(var n={},r=[],i=0;i<t.length;i++){var o=t[i],s=e.base?o[0]+e.base:o[0],c=n[s]||0,l="".concat(s," ").concat(c);n[s]=c+1;var f=u(l),h={css:o[1],media:o[2],sourceMap:o[3]};-1!==f?(a[f].references++,a[f].updater(h)):a.push({identifier:l,updater:p(h,e),references:1}),r.push(l)}return r}function c(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var l,f=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function h(t,e,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=f(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function v(t,e,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var d=null,g=0;function p(t,e){var n,r,i;if(e.singleton){var o=g++;n=d||(d=c(e)),r=h.bind(null,n,o,!1),i=h.bind(null,n,o,!0)}else n=c(e),r=v.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=s(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<n.length;r++){var i=u(n[r]);a[i].references--}for(var o=s(t,e),c=0;c<n.length;c++){var l=u(n[c]);0===a[l].references&&(a[l].updater(),a.splice(l,1))}n=o}}}},function(t,e,n){var r=n(2),i=n(8),o=n(9),a=n(10);(e=r(!1)).i(i);var u=o(a);e.push([t.i,'html {\n    height:100%;\n}\nbody {\n\tbackground-color:rgb(50,50,50);\n\tmargin:0;\n\ttext-align:center;\n\tbackground:linear-gradient(rgb(50,50,50), rgb(60,60,60));\n    height:100%;\n    display:flex;\n}\n\nhtml, body {\n    overflow-x:hidden;\n    overflow-y:hidden;\n}\n\n* {\n    box-sizing: border-box;\n    border:0;\n    margin:0;\n}\n\nbody {\n    box-sizing: border-box;\n}\n\ndiv#container {\n    display:flex;\n    flex-direction: column;\n    width:600px;\n    margin:auto auto;\n    border-radius: 50px;\n    padding: 30px;\n    max-width: 100%;\n    max-height:100%;\n}\n\ndiv#container>.screen {\n    display:flex;\n    flex-direction: row;\n    align-items: flex-start;\n    justify-content: space-around;\n    max-width: 100%;\n    max-height: 75%;\n}\n\ndiv.holding, div.next {\n    text-align: left;\n    max-width:20%;\n}\n\ncanvas#game {\n\tbackground: linear-gradient(rgb(100,100,100), rgb(80,80,80));\n    border-radius: 5px;\n    width:100%;\n}\n\n.game-canvas-container {\n    position:relative;\n    max-width: 50%;\n    max-height: 100%;\n}\n\n\ncanvas#holding, canvas#next {\n\twidth: 100%;\n}\ndiv.holding, div.next {\n\tbackground-color: #000;\n\tvertical-align: top;\n\tborder-radius: 20px;\n\tbackground: linear-gradient(#1E1E1E, #3C3C3C);\n}\ndiv.holding p, div.next p, p.scorelbl {\n\tfont-family: sans-serif;\n\tcolor: #FFF;\n\tfont-weight: bold;\n\tmargin: 10px 0px 0px 10px;\n}\n\n/* <p>Score: <span id="score">0</span></p> */\np.scorelbl {\n\tmargin: 0px 0px 10px 0px;\n}\n\n.tetris-logo {\n    width:300px;\n    height:73px;\n    background-image: url('+u+");\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    margin:auto;\n    margin-bottom: 10px;\n    max-width: 100%;\n}\n\n",""]),t.exports=e},function(t,e,n){(e=n(2)(!1)).push([t.i,"body.lite-view { \n    background: rgba(0, 0, 0, 0) !important; margin: 0px auto; overflow: hidden;\n}\nbody.lite-view .tetris-logo {\n    display:none !important;\n}\nbody.lite-view #container {\n    background: rgba(0, 0, 0, 0) !important;\n    zoom:1.5;\n}\n\nbody.lite-view span.holding, \nbody.lite-view span.next, \nbody.lite-view #game {\n\tborder-radius:0 !important;\n}",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t,e){return e||(e={}),"string"!=typeof(t=t&&t.__esModule?t.default:t)?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t)}},function(t,e,n){t.exports=n.p+"img/e27f40867ed340c0c4c40a25182347b8.svg"},function(t,e,n){"use strict";n.r(e),n.d(e,"initDebug",(function(){return a}));var r=n(0),i=n(4),o=n(1);function a(t,e,n){var a=new r.a(e),u=r.a.stringToElement(i);a.append(u);var s=a.querySelector("[data-target='clickTick']");s.el.addEventListener("change",(function(t){n.setup.clickTick=t.target.checked})),s.react((function(){return n.setup.clickTick})).addHandler((function(t){s.el.checked=t}));var c=a.querySelector("[data-target='simulation-viewer']");if(null!=n.simulator){var l=-1,f=[],h=n.graphicsEngine,v=document.createElement("canvas").getContext("2d");v.canvas.style.position="absolute",v.canvas.style.top="0px",v.canvas.style.left="0px",v.canvas.style.width="100%",v.canvas.style.pointerEvents="none",h.gameCtx.canvas.parentElement.appendChild(v.canvas);var d=function(){if(console.log("draw: "+l),l<0)console.log("TODO CLEAR");else{var t=f[l];console.log(t),v.canvas.width=h.gameCtx.canvas.width,v.canvas.height=h.gameCtx.canvas.height;for(var e=0;e<n.height;e++)for(var r=0;r<n.width;r++)if(!0===t.brickMatrix[e][r]){var i=new o.Color(255,0,0,1);h.drawSquare(v,r,e,i)}}},g=c.querySelector("[data-target='simulationSelector']");g.react((function(){return f})).addHandler((function(){console.log("UPDATED MOVEMENTS"),g.el.max=f.length-1,g.el.value=0,d()})),n.simulator.addEvent("update-movements",(function(t){f=t})),console.log("simulator is enabled"),f=n.simulator.movements,g.el.addEventListener("input",(function(t){l=t.target.value,d()})),c.querySelector("[data-target='sim-up']").el.addEventListener("click",(function(){(l+=1)>f.length&&(l=f.length),g.el.value=l,d()})),c.querySelector("[data-target='sim-down']").el.addEventListener("click",(function(){(l-=1)<0&&(l=0),g.el.value=l,d()}))}else console.log("simulator is not enabled"),c.style.display="none";e.parentNode.insertBefore(a.el,e.nextSibling)}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"createGuid",(function(){return x})),n.d(r,"createUniqueGuid",(function(){return M}));var i={};n.r(i),n.d(i,"debug",(function(){return E})),n.d(i,"info",(function(){return T})),n.d(i,"log",(function(){return O})),n.d(i,"warn",(function(){return C})),n.d(i,"error",(function(){return P})),n.d(i,"count",(function(){return B}));var o={};n.r(o),n.d(o,"guid",(function(){return r})),n.d(o,"trace",(function(){return i})),n.d(o,"color",(function(){return I}));var a={};n.r(a),n.d(a,"BrickFormBase",(function(){return rt})),n.d(a,"SimpleBrickForm",(function(){return ot})),n.d(a,"BinaryBrickForm",(function(){return st}));var u={};n.r(u),n.d(u,"Brick",(function(){return F})),n.d(u,"form",(function(){return a}));var s={};n.r(s),n.d(s,"executeTick",(function(){return ct})),n.d(s,"gameControlDown",(function(){return lt}));var c={};n.r(c),n.d(c,"EventController",(function(){return yt}));var l={};n.r(l),n.d(l,"cloneGame",(function(){return qt})),n.d(l,"getPossibleMoves",(function(){return Ft})),n.d(l,"attachSimulator",(function(){return Zt}));var f={};n.r(f),n.d(f,"NextBrick",(function(){return fe})),n.d(f,"StaticNextBrick",(function(){return ve})),n.d(f,"EasyNextBrick",(function(){return ge}));var h={};n.r(h),n.d(h,"nextBrick",(function(){return f})),n.d(h,"simulation",(function(){return l}));var v={};n.r(v),n.d(v,"transmitter",(function(){return pe})),n.d(v,"receiver",(function(){return ye}));var d={};n.r(d),n.d(d,"INIT_TYPES",(function(){return xe})),n.d(d,"AddonContainer",(function(){return Ee}));var g={};n.r(g),n.d(g,"TetrisSetup",(function(){return kn})),n.d(g,"defaultGame",(function(){return xn})),n.d(g,"easyGame2",(function(){return Mn})),n.d(g,"easyGame",(function(){return Sn})),n.d(g,"longPieceGame",(function(){return En})),n.d(g,"shitGame",(function(){return Tn})),n.d(g,"predictableGameWithOneBlock",(function(){return On}));var p={};n.r(p),n.d(p,"Options",(function(){return _n})),n.d(p,"init",(function(){return Ln}));var y={};n.r(y),n.d(y,"EngineBase",(function(){return Gn}));var m={};n.r(m),n.d(m,"TetrisGame",(function(){return ln})),n.d(m,"logic",(function(){return h})),n.d(m,"gameController",(function(){return s})),n.d(m,"setup",(function(){return g})),n.d(m,"init",(function(){return p})),n.d(m,"engine",(function(){return y}));var b={};n.r(b),n.d(b,"addon",(function(){return d})),n.d(b,"event",(function(){return c}));n(5);function w(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^Math.round(255*Math.random())&15>>t/4).toString(16)}))}var k=[];function x(){var t=w();return-1===k.indexOf(t)&&k.push(k),t}function M(){var t;do{t=w()}while(-1!==k.indexOf(t));return k.push(t),t}function S(){}var E=S,T=S,O=console.log,C=console.warn,P=console.error,B=console.count,I=n(1);function A(t,e){if("number"!=typeof e)throw new Error("rotations parameter must be a number");if(!isFinite(e))throw new Error("rotations parameter must be a finite number");if(0==(e=(4+e%4)%4))return t.concat();for(var n=[],r=t[0].length,i=t.length,o=0;o<i;o++){var a=[],u=null;switch(e){case 2:u=t[i-o-1]}for(var s=0;s<r;s++)switch(e){case 1:u=t[r-s-1],a[s]=u[o];break;case 2:a[s]=u[r-s-1];break;case 3:u=t[s],a[s]=u[i-o-1]}n[o]=a}return n}function j(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function _(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var L=r.createUniqueGuid,D=new WeakMap,U=new WeakMap,G=new WeakMap,H=new WeakMap,q=new WeakMap,F=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),D.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:0}),H.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0});var n=e||{ingame:!1,game:null};"string"==typeof n.guid?_(this,q,n.guid):_(this,q,L()),this.game=n.game,this.ingame=n.ingame,null!=n.brickform&&(null!=this.game&&(this.color=this.game.getColors()[0].copy()),this.blocks=n.brickform.concat()),"number"==typeof n.x&&"number"==typeof n.y&&(this.x=n.x,this.y=n.y)}var e,n,r;return e=t,r=[{key:"calcAbsoluteBlocks",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=[],a=e+r,u=n+i;for(var s in t)for(var c in t[s])1==t[s][c]&&o.push({x:a+parseInt(c),y:u+parseInt(s)});return o}},{key:"calcHeight",value:function(t){var e=0;for(var n in t)for(var r in t[n])1==t[n][r]&&(e=Math.max(e,parseInt(n)+1));return e}},{key:"calcWidth",value:function(t){var e=0,n=Infinity;for(var r in t)for(var i in t[r])1==t[r][i]&&(e=Math.max(e,parseInt(i)+2),n=Math.min(n,parseInt(i)+2));return e-n+1}},{key:"calcBlockX",value:function(t){for(var e=0,n=0,r=0;r<4;r++){for(var i in e=0,t)0==t[i][r]&&e++;if(e!=t.length)return n;n++}}},{key:"rotateRight",value:function(t){return function(t){return A(t,1)}(t)}},{key:"rotateLeft",value:function(t){return function(t){return A(t,-1)}(t)}},{key:"rotateTwice",value:function(t){return function(t){return A(t,2)}(t)}},{key:"rotateBlocks",value:function(t,e){return A(t,e)}},{key:"calcValidPosition_xOutRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;if(n+i+r+t>o.width){if(!0===e)throw new Error("The brick would be out of bounds");return!1}return!0}},{key:"calcValidPosition_xOutLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n+r+t<0){if(!0===e)throw new Error("The brick would be out of bounds");return!1}return!0}},{key:"calcValidPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,l=t.calcBlockX(a);if(!t.calcValidPosition_xOutLeft(e,r,i,l,s))return!1;var f=t.calcWidth(a);if(!t.calcValidPosition_xOutRight(e,r,i,l,f,s))return!1;if(o+t.calcHeight(a)+n>s.height){if(!0===r)throw new Error("The brick would be out of bounds");return!1}if(t.calcWillCollide(e,n,u,a,i,o,c)){if(!0===r)throw new Error("The brick would collide with another brick");return!1}return!0}},{key:"calcMostLeft",value:function(e){return parseInt(-t.calcBlockX(e))}},{key:"calcMostRight",value:function(e,n){return parseInt(e-t.calcWidth(n)-t.calcBlockX(n))}},{key:"calcWillCollide",value:function(e,n,r,i,o,a,u){var s,c=t.calcAbsoluteBlocks(i,o,a,e,n),l=j(r);try{for(l.s();!(s=l.n()).done;){var f=s.value;if(f.guid!==u){var h,v=f.getAbsoluteBlocks(),d=j(c);try{for(d.s();!(h=d.n()).done;){var g,p=h.value,y=j(v);try{for(y.s();!(g=y.n()).done;){var m=g.value;if(m.x===p.x&&m.y===p.y)return!0}}catch(t){y.e(t)}finally{y.f()}}}catch(t){d.e(t)}finally{d.f()}}}}catch(t){l.e(t)}finally{l.f()}return!1}},{key:"calcLowestPosition",value:function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,s=t.calcHeight(e),c=0;!(a+c+s>r||t.calcWillCollide(n,c,i,e,o,a,u));)c++;return a+c-1}}],(n=[{key:"guid",get:function(){return N(this,q)}},{key:"index",get:function(){return N(this,H)},set:function(t){_(this,H,t)}},{key:"clone",value:function(){var e=new t({guid:N(this,q)});return _(e,D,N(this,D)),_(e,U,N(this,U)),e.moving=this.moving,e.blocks=this.blocks.concat(),e.color=this.color.copy(),_(e,G,N(this,G)),e.index=this.index,e}},{key:"x",get:function(){return N(this,D)},set:function(t){_(this,D,t),this.requestUpdate()}},{key:"y",get:function(){return N(this,U)},set:function(t){_(this,U,t),this.requestUpdate()}},{key:"containerWidth",get:function(){return this.blocks[0].length}},{key:"containerHeight",get:function(){return this.blocks.length}},{key:"requestUpdate",value:function(){this.ingame&&null!=this.game&&(this.game.PENDINGUPDATE=!0)}},{key:"resetPosition",value:function(){this.x=Math.round(this.game.width/2-this.blocks[0].length/2),this.y=Math.round(0-this.blocks.length)}},{key:"getAbsoluteBlocks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return null==e&&(e=this.blocks),t.calcAbsoluteBlocks(e,this.x,this.y,n,r)}},{key:"checkCollision",value:function(t,e,n){for(var r in n)for(var i in n[r].blocks)for(var o in n[r].blocks[i])if(1==n[r].blocks[i][o]){var a=t==n[r].x+parseInt(o),u=e==n[r].y+parseInt(i),s=this!=n[r];if(a&&u&&s)return!1}return!0}},{key:"getHeight",value:function(){return t.calcHeight(this.blocks)}},{key:"getWidth",value:function(){return t.calcWidth(this.blocks)}},{key:"getBlockY",value:function(){var t=0,e=0;for(var n in this.blocks){for(var r in this.blocks[n])0==this.blocks[n][r]&&t++;if(t!=this.blocks[0].length)return e;e++}}},{key:"getBlockX",value:function(){return t.calcBlockX(this.blocks)}},{key:"rotate_okay",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.calcValidPosition(0,0,r,e.x,e.y,n,this.game.bricks,this.game,this.guid)}},{key:"createRotatedRightBlocks",value:function(){return t.rotateRight(this.blocks)}},{key:"createRotatedLeftBlocks",value:function(){return t.rotateLeft(this.blocks)}},{key:"createRotatedTwiceBlocks",value:function(){return t.rotateTwice(this.blocks)}},{key:"createRotatedBlocks",value:function(e){return t.rotateBlocks(this.blocks,e)}},{key:"canRotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.rotate_okay(this,e||this.createRotatedRightBlocks(),t)}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){var n=this.createRotatedRightBlocks();if(this.canRotate(e,n))this.requestUpdate();else{var r=t.calcBlockX(n),i=t.calcWidth(n);if(t.calcValidPosition_xOutRight(0,!1,this.x,r,i,this.game)){if(t.calcValidPosition_xOutLeft(0,!1,this.x,r,this.game))return!1;if(this.x++,!this.rotate_okay(this,n))return this.x--,!1;this.requestUpdate()}else{if(this.x--,!this.rotate_okay(this,n))return this.x++,!1;this.requestUpdate()}}this.blocks=n,_(this,G,(N(this,G)+1)%4)}}},{key:"rotation",get:function(){return N(this,G)},set:function(t){for(var e=N(this,G);e<=t;e++)this.rotate();_(this,G,t)}},{key:"posInfo",value:function(){return[["x",this.x],["y",this.y],["rotation",N(this,G)]].map((function(t){return t.join(":")})).join(",")}},{key:"validatePosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return"number"!=typeof i&&(i=this.x),"number"!=typeof o&&(o=this.y),t.calcValidPosition(e,n,r,i,o,this.blocks,this.game.bricks,this.game,this.guid)}},{key:"canMoveLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===t)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===t)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(-1,0,t)}},{key:"moveleft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamemove"),this.canMoveLeft(t))return this.x--,!0;if(!0===t)throw new Error("Unknown reason");return!1}if(!0===t)throw new Error("The game is not running");return i.debug("did not move right: out of conditions"),!1}},{key:"innerX",get:function(){return this.x-this.getBlockX()}},{key:"innerXfar",get:function(){return this.innerX+this.innerWidth}},{key:"mostLeft",get:function(){return t.calcMostLeft(this.blocks)}},{key:"mostRight",get:function(){return t.calcMostRight(this.game.width,this.blocks)}},{key:"innerWidth",get:function(){return this.getWidth()}},{key:"willCollide",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return null==i&&(i=this.blocks),null==r&&(r=this.game.bricks),t.calcWillCollide(e,n,r,i,this.x,this.y,this.guid)}},{key:"canMoveRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===t)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===t)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(1,0,t)}},{key:"moveright",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running){if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamemove"),this.canMoveRight(t))return this.x++,!0;if(!0===t)throw new Error("Unknown reason");return!1}if(!0===t)throw new Error("The game is not running");return i.debug("did not move right: out of conditions"),!1}},{key:"canSmashDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===t)throw new Error("The game is not running");return!1}return!0}},{key:"smashdown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.canSmashDown(t))if(!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamebump"),this.moving=!1,this.y=this.getLowestPosition(),this.requestUpdate(),this.y+this.getBlockY()>=0){var e=this.slice_up();for(var n in this.game.bricks.splice(this.findMe(),1),e)this.game.bricks.push(e[n]);this.game.checkLines(),this.game.addNewBrick(),this.game.HOLDINGCOUNT=0}else this.game.loseView(),!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamelose")}},{key:"canMoveDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1!=this.game.running){if(!0===t)throw new Error("The game is not running");return!1}if(1!=this.moving){if(!0===t)throw new Error("The brick is not flagged as moving");return!1}return this.validatePosition(0,1,t)}},{key:"movedown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.game.running&&this.moving)if(this.canMoveDown(t))this.y++;else if(this.moving=!1,!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamebump"),this.y+this.getBlockY()>=0){var e=this.slice_up();for(var n in this.game.bricks.splice(this.findMe(),1),e)this.game.bricks.push(e[n]);this.game.checkLines(),this.game.addNewBrick(),this.game.HOLDINGCOUNT=0}else this.game.loseView(),!0===this.ingame&&this.game.runEvent("fx",null,"sound","gamelose")}},{key:"getLowestPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.calcLowestPosition(this.blocks,e,this.game.height,this.game.bricks,this.x,this.y,this.guid)}},{key:"slice_up",value:function(){var e,n,r,i,o=[],a=this.color;for(var u in this.blocks)for(var s in this.blocks[u])1==this.blocks[u][s]&&o.push((e=parseInt(s)+this.x,n=parseInt(u)+this.y,r=this,i=void 0,(i=new t).moving=!1,i.blocks=[[1]],i.color=a,i.x=e,i.y=n,i.id=r.id,i.index=r.index,i));return o}},{key:"findMe",value:function(){for(var t in this.game.bricks)if(this.game.bricks[t]==this)return t;return i.warn("findMe could not find brick in game"),-1}}])&&W(e.prototype,n),r&&W(e,r),t}();function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function X(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=K(t);if(e){var i=K(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return $(this,n)}}function $(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?J(t):e}function J(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Q(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function Z(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(t,e,n){return e&&et(t.prototype,e),n&&et(t,n),t}F.emulate=function(t){var e=new F({ingame:!1,game:null});return e.moving=!1,e.blocks=t,e};var rt=function(){function t(){tt(this,t)}return nt(t,[{key:"getBrickForm",value:function(){throw new Error("missing implementation")}}]),t}(),it=new WeakMap,ot=function(t){X(n,t);var e=Y(n);function n(t){var r;return tt(this,n),r=e.call(this),it.set(J(r),{writable:!0,value:void 0}),Z(J(r),it,t),r}return nt(n,[{key:"getBrickForm",value:function(){return JSON.parse(JSON.stringify(Q(this,it)))}}]),n}(rt),at=new WeakMap,ut=new WeakMap,st=function(t){X(n,t);var e=Y(n);function n(t,r){var i;if(tt(this,n),!(r>0))throw new Error("Size must be more than 0");return i=e.call(this),at.set(J(i),{writable:!0,value:void 0}),ut.set(J(i),{writable:!0,value:void 0}),Z(J(i),at,t),Z(J(i),ut,r),i}return nt(n,[{key:"getBrickForm",value:function(){for(var t=Q(this,ut),e=0;e<t;e++)1,1;for(var n=[[]],r=Q(this,at),i=0;i<t*t;i++){var o=0;1==(1&r)&&(o=1),n[0].length==t&&n.splice(0,0,[]),n[0].splice(0,0,o),r>>=1}return n}}]),n}(rt);function ct(t){var e=t.getMovingBrick();null!=e&&e.movedown(),t.runEvent("tick",null)}function lt(t){!function e(){!0!==t.setup.clickTick&&ct(t),setTimeout(e,t.movingSpeed)}()}function ft(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ht(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function dt(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var gt=new WeakMap,pt=new WeakMap,yt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),gt.set(this,{writable:!0,value:[]}),pt.set(this,{writable:!0,value:null}),function(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,pt,e)}var e,n,r;return e=t,(n=[{key:"on",value:function(t,e){dt(this,gt).push({name:t,handler:e})}},{key:"trigger",value:function(t,e){null===e&&(e=dt(this,pt));for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o,a=ft(dt(this,gt));try{for(a.s();!(o=a.n()).done;){var u=o.value;u.name===t&&u.handler.apply(e,r)}}catch(t){a.e(t)}finally{a.f()}}}])&&vt(e.prototype,n),r&&vt(e,r),t}();function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){return(bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xt(t);if(e){var i=xt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return kt(this,n)}}function kt(t,e){return!e||"object"!==mt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function xt(t){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function St(t,e,n){return e&&Mt(t.prototype,e),n&&Mt(t,n),t}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bt(t,e)}(n,t);var e=wt(n);function n(t){var r;Et(this,n),r=e.call(this,t);var i=t.rotation,o=t.needsHolding;return r.rotation=i,r.needsHolding=o,r.holdingFired=!1,r}return St(n,[{key:"getNextInstruction",value:function(){var t=this;return function(e){if(!0===t.needsHolding&&!0!==t.holdingFired)return t.holdingFired=!0,void e.holdingShift();var n=e.getMovingBrick();n.rotation!==t.rotation||n.x!==t.x?e.moveTowards(t.x,t.rotation):e.input.smashDown()}}}]),n}(St((function t(e){var n=e.x,r=e.y,i=e.brickMatrix;Et(this,t),this.x=n,this.y=r,this.brickMatrix=i,this.score=null})));function Ot(t,e,n,r){for(var i=[],o=r,a=0;a<4;a++)for(var u=F.rotateBlocks(o.blocks,a),s=F.calcMostLeft(u),c=F.calcMostRight(t,u),l=s;l<=c;l++){var f=F.calcLowestPosition(u,l-o.x,e,n,o.x,o.y,o.guid),h=ln.renderBrickMatrix(t,e,n,[{guid:o.guid,x:l,y:f,blocks:u}]);i.push(new Tt({brickMatrix:h,x:l,y:f,rotation:a}))}return i}function Ct(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Bt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(t,e){return function(n,r){return t(e?r:n)-t(e?n:r)}};return{sorters:[n(t,e)],thenBy:function(t,e){return this.sorters.push(n(t,e)),this},compare:function(t,e){var n,r=Ct(this.sorters);try{for(r.s();!(n=r.n()).done;){var i=(0,n.value)(t,e);if(0!==i)return i}}catch(t){r.e(t)}finally{r.f()}return 0},execute:function(t){var e=this;return t.concat().sort((function(t,n){return e.compare(t,n)}))}}}function It(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function At(t){for(var e=t.length,n=t[0].length,r=[];r.length<n;){for(var i=[];i.length<e;)i.push(void 0);r.push(i)}for(var o=0;o<e;o++)for(var a=0;a<n;a++)r[a][o]=t[o][a];return r}var jt=function(){function t(e){var n=e.clearingLines,r=e.holes,i=e.height;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.clearingLines=n,this.holes=r,this.height=i}var e,n,r;return e=t,(n=[{key:"getRatio",value:function(t,e){return(2*Wt(t.clearingLines,e.clearingLines,this.clearingLines)+3*Wt(t.holes,e.holes,this.holes)+(1-this.height.blocksHeight/this.height.gameHeight))/6}}])&&It(e.prototype,n),r&&It(e,r),t}();function Rt(t){var e=function(t){for(var e=0,n=t.length-1;n>=0;n--)0===t[n].filter((function(t){return!0!==t})).length&&e++;return e}(t),n=function(t){var e=0;t=At(t);for(var n=0;n<t.length;n++){var r=t[n].indexOf(!0);if(-1!==r)for(var i=r;i<t[n].length;i++)!1===t[n][i]&&e++}return e}(t),r=function(t){var e=0;t=At(t);for(var n=null,r=0;r<t.length;r++){var i=t[r];null==n&&(n=i.length);var o=i.indexOf(!0);if(!(o<0)){var a=i.length-o;a>e&&(e=a)}}return{blocksHeight:e,gameHeight:n}}(t);return new jt({holes:n,height:r,clearingLines:e})}function Wt(t,e,n){return t==e?1:(n-t)/(e-t)}function Nt(t){var e=function(t){t=t.concat();var e=Bt((function(t){return t.scores.clearingLines}),!1).execute(t)[0].scores.clearingLines,n=Bt((function(t){return t.scores.height}),!0).execute(t)[0].scores.height,r=Bt((function(t){return t.scores.holes}),!0).execute(t)[0].scores.holes;return new jt({clearingLines:e,holes:r,height:n})}(t),n=function(t){t=t.concat();var e=Bt((function(t){return t.scores.clearingLines}),!0).execute(t)[0].scores.clearingLines,n=Bt((function(t){return t.scores.height}),!1).execute(t)[0].scores.height,r=Bt((function(t){return t.scores.holes}),!1).execute(t)[0].scores.holes;return new jt({clearingLines:e,holes:r,height:n})}(t);return Bt((function(t){return t.scores.getRatio(e,n)}),!0).thenBy((function(t){return t.scores.clearingLines}),!0).thenBy((function(t){return t.scores.holes}),!1).thenBy((function(t){return t.scores.height}),!1).execute(t)}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Lt(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function Dt(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function Ut(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ht=I.Color;function qt(t,e){var n={bricks:t.bricks.concat().map((function(t){return t.clone()}))};null!=t.HOLDING&&(n.holding=t.HOLDING.clone());var r=Object.assign({},t.setup,e,{brickforms:t.setup.brickforms,width:t.setup.width,height:t.setup.height,sequence:t.setup.sequence}),i=new ln(r,n);return i.brickforms=t.brickforms,i.HOLDINGCOUNT=t.HOLDINGCOUNT,i}function Ft(t,e){var n,r=[],o=Ut(Ot(t.width,t.height,t.bricks,t.getMovingBrick()));try{for(o.s();!(n=o.n()).done;){var a=n.value;r.push(a)}}catch(t){o.e(t)}finally{o.f()}if(t.canUseHolding){var u=qt(t,e);u.holdingShift();var s,c=Ut(Ot(u.width,u.height,u.bricks,u.getMovingBrick()));try{for(c.s();!(s=c.n()).done;){var l=s.value;l.needsHolding=!0,r.push(l)}}catch(t){c.e(t)}finally{c.f()}}for(var f=0,h=r;f<h.length;f++){var v=h[f];v.scores=Rt(v.brickMatrix)}return r=Nt(r),i.debug("POSITIONS",r),r}var zt=new WeakMap,Xt=new WeakMap,Vt=new WeakMap,Yt=new WeakMap,$t=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Qt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),zt.set(this,{writable:!0,value:[]}),Xt.set(this,{writable:!0,value:void 0}),Vt.set(this,{writable:!0,value:!1}),Yt.set(this,{writable:!0,value:"assist"}),$t.set(this,{writable:!0,value:[]}),Jt.set(this,{writable:!0,value:0}),Kt.set(this,{writable:!0,value:new yt(this)})}var e,n,r;return e=t,(n=[{key:"attach",value:function(t){Dt(this,Xt,t);var e=this;Lt(this,Xt).addEvent("current-brick-change",(function(){i.debug("current brick change"),e.getNewMove()}))}},{key:"drawMovements",value:function(){var t=this;if(Lt(this,zt).length>0){var e=Lt(this,zt)[0].brick;i.debug("drawing",e);var n=new Ht(255,255,255,.2);setTimeout((function(){return Lt(t,Xt).drawBrick(e,n)}),50)}}},{key:"cancel",value:function(){Dt(this,Vt,!0)}},{key:"isCancelled",get:function(){return Lt(this,Vt)}},{key:"start",value:function(){var t=this;Dt(this,Jt,(new Date).getTime()),!0===Lt(this,Xt).setup.clickTick?(Lt(this,Xt).ghostDrawing=!1,Lt(this,Xt).addEvent("tick",(function(){!1===t.isCancelled&&(t.tick(),t.drawMovements())}))):setTimeout((function e(){!1===t.isCancelled&&(t.tick(),setTimeout(e,t.getTimeout()))}),0),Lt(this,Xt).addEvent("lose",(function(){t.cancel()}))}},{key:"getTimeout",value:function(){return 100}},{key:"setMode",value:function(t){Dt(this,Yt,t)}},{key:"setSimulation",value:function(t){Dt(this,$t,JSON.parse(JSON.stringify(t)))}},{key:"tick",value:function(){if(!0===Lt(this,Xt).running)if("assist"===Lt(this,Yt))this.assistTick();else{if("playback"!==Lt(this,Yt))throw new Error("Mode is not supported: "+Lt(this,Yt));this.playbackTick()}}},{key:"getNewMove",value:function(){Dt(this,zt,Ft(Lt(this,Xt),{nextBrick:new ve(0)})),Lt(this,Kt).trigger("update-movements",null,Lt(this,zt).concat())}},{key:"addEvent",value:function(t,e){Lt(this,Kt).on(t,e)}},{key:"targetMovement",get:function(){if(!(Lt(this,zt).length<1))return Lt(this,zt)[0]}},{key:"assistTick",value:function(){var t=this.targetMovement;if(null!=t){var e=t.getNextInstruction();if(void 0!==e){if("function"!=typeof e)throw new Error("Unknown instruction type");e(Lt(this,Xt))instanceof Promise&&i.warn("TODO: async handle / promise await missing")}}}},{key:"playbackTick",value:function(){throw new Error("Not implemented")}},{key:"movements",get:function(){return Lt(this,zt)}}])&&_t(e.prototype,n),r&&_t(e,r),t}();function Zt(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new Qt;return n.attach(t),Array.isArray(t.setup.simulation)&&(n.setMode("playback"),n.setSimulation(t.setup.simulation)),!0===e&&n.start(),n}function te(t){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ee(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ne(t,e)}function ne(t,e){return(ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ae(t);if(e){var i=ae(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ie(this,n)}}function ie(t,e){return!e||"object"!==te(e)&&"function"!=typeof e?oe(t):e}function oe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ae(t){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ue(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function se(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function le(t,e,n){return e&&ce(t.prototype,e),n&&ce(t,n),t}var fe=function(){function t(){se(this,t)}return le(t,[{key:"nextBrick",value:function(t){for(var e=t.nextRandom,n=e;n===e;)n=Math.round(Math.random()*(t.brickforms.length-1));return n}}]),t}(),he=new WeakMap,ve=function(t){ee(n,t);var e=re(n);function n(t){var r;return se(this,n),r=e.call(this),he.set(oe(r),{writable:!0,value:void 0}),ue(oe(r),he,t),r}return le(n,[{key:"nextBrick",value:function(){return function(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}(this,he)}}]),n}(fe),de=new WeakMap,ge=function(t){ee(n,t);var e=re(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return se(this,n),t=e.call(this),de.set(oe(t),{writable:!0,value:void 0}),ue(oe(t),de,r||new fe),t}return le(n,[{key:"nextBrick",value:function(t){for(var e=t.bricks.concat().sort((function(t,e){return e.id-t.id}))[0],n=[],r=0;r<t.brickforms.length;r++)if(null==e||r!=e.index){var i=this.getPossibleMovesForType(t,r)[0];n.push({i:r,move:i})}return Nt(n)[0].move.brick.index}},{key:"getPossibleMovesForType",value:function(t,e){var n={};n.nextBrick=new ve(e);var r=qt(t,n);return r.addNewBrick(),Ft(r)}}]),n}(fe);function pe(){throw new Error("Not implemented")}function ye(){throw new Error("Not implemented")}function me(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return be(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return be(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function we(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ke(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var xe={AFTER_INIT:"after-init"},Me=new WeakMap,Se=new WeakMap,Ee=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Me.set(this,{writable:!0,value:[]}),Se.set(this,{writable:!0,value:[]})}var e,n,r;return e=t,(n=[{key:"add",value:function(t,e,n){var r;switch(n){case xe.AFTER_INIT:r={initType:n,object:t,callback:e,loaded:!1};break;default:throw new Error("Unknown INIT_TYPE: "+n)}ke(this,Me).push(r),this.typeIsAlreadyLoaded(n)&&this.loadAddon(r)}},{key:"typeIsAlreadyLoaded",value:function(t){return-1!==ke(this,Se).indexOf(t)}},{key:"loadByType",value:function(t){if(this.typeIsAlreadyLoaded(t))throw new Error("Type "+t+" has already been loaded");ke(this,Se).push(t);var e,n=me(ke(this,Me));try{for(n.s();!(e=n.n()).done;){var r=e.value;r.initType===t&&!1===r.loaded&&this.loadAddon(r)}}catch(t){n.e(t)}finally{n.f()}}},{key:"loadAddon",value:function(t){if(!1!==t.loaded)throw new Error("Addon is already loaded");t.loaded=!0,t.callback(t.object)}}])&&we(e.prototype,n),r&&we(e,r),t}();function Te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oe(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var Ce=new WeakMap,Pe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ce.set(this,{writable:!0,value:void 0}),function(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,Ce,e)}var e,n,r;return e=t,(n=[{key:"smashDown",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).getMovingBrick().smashdown(!0)}},{key:"left",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).getMovingBrick().moveleft()}},{key:"rotate",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).getMovingBrick().rotate()}},{key:"right",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).getMovingBrick().moveright()}},{key:"down",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).getMovingBrick().movedown()}},{key:"hold",value:function(){!0===Oe(this,Ce).running&&Oe(this,Ce).holdingShift()}}])&&Te(e.prototype,n),r&&Te(e,r),t}();function Be(t){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ie(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ae(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function We(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function Ne(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var _e=l.attachSimulator,Le=I.Color,De=v.transmitter,Ue=f.NextBrick,Ge=new WeakMap,He=new WeakMap,qe=new WeakMap,Fe=new WeakMap,ze=new WeakMap,Xe=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,$e=new WeakMap,Je=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,Ze=new WeakMap,tn=new WeakMap,en=new WeakMap,nn=new WeakMap,rn=new WeakMap,on=new WeakMap,an=new WeakMap,un=new WeakMap,sn=new WeakMap,cn=new WeakMap,ln=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(je(this,t),Ge.set(this,{writable:!0,value:void 0}),He.set(this,{writable:!0,value:void 0}),qe.set(this,{writable:!0,value:!0}),Fe.set(this,{writable:!0,value:null}),ze.set(this,{writable:!0,value:!1}),Xe.set(this,{writable:!0,value:0}),Ve.set(this,{writable:!0,value:void 0}),Ye.set(this,{writable:!0,value:-1}),$e.set(this,{writable:!0,value:void 0}),Je.set(this,{writable:!0,value:[]}),Ke.set(this,{writable:!0,value:void 0}),Qe.set(this,{writable:!0,value:void 0}),Ze.set(this,{writable:!0,value:new yt(this)}),tn.set(this,{writable:!0,value:new Ee}),en.set(this,{writable:!0,value:null}),nn.set(this,{writable:!0,value:!0}),rn.set(this,{writable:!0,value:null}),on.set(this,{writable:!0,value:void 0}),an.set(this,{writable:!0,value:[]}),un.set(this,{writable:!0,value:void 0}),sn.set(this,{writable:!0,value:void 0}),cn.set(this,{writable:!0,value:0}),We(this,Ke,e),We(this,sn,e.nextBrick||new Ue),We(this,un,i),null!=Ne(this,un)&&Ne(this,un).setGame(this),!0===e.logger&&this.addLogEntry({name:"gameInit"}),We(this,Ge,e.width),We(this,He,e.height),We(this,on,Math.round(1e16*Math.random())),We(this,Qe,new Le(0,255,0,.5)),null!=r){if(Array.isArray(r.bricks)){We(this,Je,r.bricks.concat());var o,a=Ie(Ne(this,Je));try{for(a.s();!(o=a.n()).done;){var u=o.value;u.game=this}}catch(t){a.e(t)}finally{a.f()}}null!=r.holding&&(We(this,Fe,r.holding),Ne(this,Fe).game=this)}this.brickforms=e.brickforms;var s=[new Le(255,0,0,1),new Le(0,255,0,1),new Le(0,0,255,1),new Le(255,255,0,1),new Le(0,255,255,1),new Le(255,0,255,1),new Le(0,128,128,1)];this.setNextRandom();var c=this;function l(t){var e=this;if(Ne(this,nn)){this.score++,this.runEvent("fx",null,"sound","gamerow");var n=c.bricks;!function(t){var r=0;for(r=0;r<=e.width;r++)for(var i in n)for(var o in n[i].blocks)for(var a in n[i].blocks[o])if(1==n[i].blocks[o][a]){var u=t==n[i].y+parseInt(o),s=0==n[i].moving;u&&s&&n.splice(parseInt(i),1)}}(t),function(t){for(var e in n)for(var r in n[e].blocks)for(var i in n[e].blocks[r])if(1==n[e].blocks[r][i]){var o=t>n[e].y+parseInt(r),a=0==n[e].moving;o&&a&&n[e].y++}}(t)}}this.getColors=function(){return s},this.checkLines=function(){if(Ne(n,nn)){for(var t,e=n.height;e>1;e--){var r=0;for(t=0;t<=n.width-1;t++)n.checkXY(t,e)&&r++;r==n.width&&l.call(n,e++)}n.PENDINGUPDATE=!0}},this.init=function(){if(We(this,nn,!0),this.score=0,this.HOLDINGCOUNT=0,!0===this.setup.simulator&&We(this,en,_e(this)),this.addNewBrick(),lt(this),!0===this.setup.logger){var t=De(),e=this;setInterval((function(){if(null!=Ne(e,rn)&&Ne(e,rn).readyState===Ne(e,rn).OPEN)for(var t;(t=Ne(e,an).splice(0,1)).length>0;){var n,r=Ie(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;Ne(e,rn).send(JSON.stringify(i))}}catch(t){r.e(t)}finally{r.f()}}})),We(this,rn,t)}null!=Ne(this,un)&&(Ne(this,un).initializeInput(),Ne(this,un).initRender()),Ne(this,tn).loadByType(xe.AFTER_INIT)},this.input=new Pe(this)}var e,n,r;return e=t,r=[{key:"renderBrickMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];r=r.concat();for(var i=[],o=0;o<e;o++){i.push([]);for(var a=0;a<t;a++)i[i.length-1].push(!1)}var u,s=Ie(n);try{var c=function(){var t=u.value;if(l=t.blocks,f=t.x,h=t.y,(v=r.filter((function(e){return e.guid==t.guid}))).length>1)throw new Error("There were multiple modifications found for a single brick!");for(g in 1==v.length&&("number"==typeof(d=v[0]).x&&(f=d.x),"number"==typeof d.y&&(h=d.y),void 0!==d.blocks&&(l=d.blocks),r.splice(r.indexOf(d),1)),l)for(p in l[g])if(1==l[g][p]){if(y=f+parseInt(p),(m=h+parseInt(g))<0)continue;if(m>e)continue;i[m][y]=!0}};for(s.s();!(u=s.n()).done;){var l,f,h,v,d,g,p,y,m;c()}}catch(t){s.e(t)}finally{s.f()}if(r.length>0)throw new Error("There were ".concat(r.length," modifications which is not used"));return i}}],(n=[{key:"gridColor",get:function(){return Ne(this,Qe)}},{key:"registerAddon",value:function(t,e,n){var r=this;Ne(this,tn).add(t,(function(t){return e(t,r)}),n)}},{key:"simulator",get:function(){return Ne(this,en)}},{key:"graphicsEngine",get:function(){return Ne(this,un)}},{key:"score",get:function(){return Ne(this,cn)},set:function(t){We(this,cn,t),Ne(this,Ze).trigger("update-score",null,t)}},{key:"colors",get:function(){return this.getColors()}},{key:"holding",get:function(){return Ne(this,Fe)},set:function(t){We(this,Fe,t)}},{key:"renderBrickMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.renderBrickMatrix(this.width,this.height,this.bricks,e)}},{key:"movingSpeed",get:function(){return 1e3}},{key:"canUseHolding",get:function(){return this.HOLDINGCOUNT<1}},{key:"getBrickId",value:function(){return(this.bricks.length>0?this.bricks.map((function(t){return t.id})).sort((function(t,e){return e-t}))[0]:0)+1}},{key:"addNewBrick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=new F({game:this,ingame:!0});e.id=this.getBrickId();var n=this.brickforms,r=this.nextRandom;e.color=this.getColors()[r].copy(),e.blocks=n[r].concat(),e.index=r,e.moving=!0,e.resetPosition(),this.logEvent({name:"newBrick",blocks:e.blocks}),this.setNextRandom(),-1===t?this.bricks.push(e):this.bricks[t]=e,Ne(this,Ze).trigger("current-brick-change",null)}},{key:"logEvent",value:function(t){if(!0===this.setup.logger){var e=Ne(this,on),n={action:"log",time:(new Date).getTime(),data:Object.assign({gameGuid:e},t)};this.addLogEntry(n)}}},{key:"addLogEntry",value:function(t){Ne(this,an).push(t)}},{key:"holdingShift",value:function(){if(this.canUseHolding)if(null==Ne(this,Fe))We(this,Fe,this.getMovingBrick()),this.addNewBrick(this.getMovingBrick().findMe()),this.HOLDINGCOUNT++;else{var t=Ne(this,Fe);We(this,Fe,this.getMovingBrick()),t.resetPosition(),this.bricks[this.getMovingBrick().findMe()]=t,this.HOLDINGCOUNT++}}},{key:"getMovingBrick",value:function(){for(var t in this.bricks)if(this.bricks[t].moving)return this.bricks[t]}},{key:"clone",value:function(){return new t}},{key:"action_smashdown",value:function(){this.input.smashDown()}},{key:"action_moveleft",value:function(){this.input.left()}},{key:"action_rotate",value:function(){this.input.rotate()}},{key:"action_moveright",value:function(){this.input.right()}},{key:"action_movedown",value:function(){this.input.down()}},{key:"ghostDrawing",get:function(){return Ne(this,qe)},set:function(t){We(this,qe,t)}},{key:"brickforms",get:function(){return Ne(this,$e)},set:function(t){We(this,$e,t)}},{key:"HOLDING",get:function(){return Ne(this,Fe)}},{key:"HOLDINGCOUNT",get:function(){return Ne(this,Xe)},set:function(t){We(this,Xe,t)}},{key:"PENDINGUPDATE",get:function(){return Ne(this,ze)},set:function(t){We(this,ze,t)}},{key:"nextRandom",get:function(){return Ne(this,Ve)},set:function(t){We(this,Ve,t)}},{key:"setNextRandom",value:function(){Array.isArray(this.setup.sequence)?(We(this,Ye,(Ne(this,Ye)+1)%this.setup.sequence.length),this.nextRandom=this.setup.sequence[Ne(this,Ye)]):this.nextRandom=Ne(this,sn).nextBrick(this)}},{key:"running",get:function(){return Ne(this,nn)}},{key:"width",get:function(){return Ne(this,Ge)}},{key:"height",get:function(){return Ne(this,He)}},{key:"bricks",get:function(){return Ne(this,Je)},set:function(t){""==t&&"object"==Be([])&&(this.score=0,this.HOLDINGCOUNT=0,We(this,Fe,null),We(this,Je,[]))}},{key:"checkXY",value:function(t,e){var n,r=Ie(this.bricks);try{for(r.s();!(n=r.n()).done;)for(var i=n.value,o=0,a=i.blocks.length;o<a;o++)for(var u=0,s=i.blocks[o].length;u<s;u++)if(1==i.blocks[o][u]){var c=t==i.x+parseInt(u),l=e==i.y+parseInt(o),f=0==i.moving;if(c&&l&&f)return!0}}catch(t){r.e(t)}finally{r.f()}return!1}},{key:"setup",get:function(){return Ne(this,Ke)}},{key:"moveTowards",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.debug("moving to",t,e);var n=this.getMovingBrick();if("number"==typeof e&&e!=this.getMovingBrick().rotation)return i.debug("rotating from "+this.getMovingBrick().rotation+" to "+e),void this.action_rotate();n.x>t?(i.debug("left"),this.action_moveleft()):n.x<t?(i.debug("right"),this.action_moveright()):(i.debug("down"),this.action_smashdown())}},{key:"addEvent",value:function(t,e){Ne(this,Ze).on(t,e)}},{key:"runEvent",value:function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];Ne(this,Ze).trigger.apply(Ne(this,Ze),[t,e].concat(r))}},{key:"loseView",value:function(){this.runEvent("fx",null,"sound","gamelose"),We(this,nn,!1),Ne(this,Ze).trigger("lose",null),!0===this.setup.simulator&&setTimeout((function(){return window.location.reload()}),2e3)}}])&&Re(e.prototype,n),r&&Re(e,r),t}();function fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vn(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function dn(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var gn=new WeakMap,pn=new WeakMap,yn=new WeakMap,mn=new WeakMap,bn=new WeakMap,wn=new WeakMap,kn=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};fn(this,t),gn.set(this,{writable:!0,value:void 0}),pn.set(this,{writable:!0,value:void 0}),yn.set(this,{writable:!0,value:void 0}),mn.set(this,{writable:!0,value:void 0}),bn.set(this,{writable:!0,value:null}),wn.set(this,{writable:!0,value:null}),dn(this,gn,e),dn(this,pn,n),dn(this,yn,r),dn(this,mn,i.graphics),dn(this,wn,i.nextBrick)}var e,n,r;return e=t,(n=[{key:"nextBrick",get:function(){return vn(this,wn)}},{key:"brickforms",get:function(){return vn(this,gn)}},{key:"width",get:function(){return vn(this,pn)}},{key:"height",get:function(){return vn(this,yn)}},{key:"sequence",get:function(){return vn(this,bn)}},{key:"graphics",get:function(){return vn(this,mn)}},{key:"setSequence",value:function(){dn(this,bn,this.brickforms.concat().map((function(t,e){return e})))}}])&&hn(e.prototype,n),r&&hn(e,r),t}();function xn(){return new kn([[[0,1,0],[0,1,0],[0,1,1]],[[0,1,0],[0,1,0],[1,1,0]],[[0,1,1],[1,1,0],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]],[[0,1,0],[1,1,1],[0,0,0]],[[1,1],[1,1]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],10,20)}function Mn(){var t=new kn([[[0,1,0],[0,1,0],[0,1,1]],[[0,1,0],[0,1,0],[1,1,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],10,20);return t.setSequence(),t}function Sn(){return new kn([[[1,1],[1,1]]],10,20)}function En(){return new kn([[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],10,20)}function Tn(){return new kn([[[0,1,1],[1,1,0],[0,0,0]]],10,20)}function On(t){return new kn([t],10,20,{nextBrick:new ve(0)})}function Cn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pn(t,e,n){return e&&Cn(t.prototype,e),n&&Cn(t,n),t}function Bn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var In=h.nextBrick.EasyNextBrick,An=g.defaultGame,jn=g.easyGame,Rn=g.longPieceGame,Wn=g.shitGame,Nn=g.easyGame2;var _n=Pn((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Bn(this,"setup",null),Bn(this,"next",null),Bn(this,"simulate",null),Bn(this,"clickTick",null),Bn(this,"logger",null),Bn(this,"view",null),Bn(this,"debug",null)}));function Ln(t,e){var n,r;switch(t.setup){case"ez":r=jn();break;case"ez2":r=Nn();break;case"long":r=Rn();break;case"shit":r=Wn();break;default:r=An()}switch(t.next){case"ez":r.nextBrick=new In}switch(t.simulate){case!0:r.simulator=!0;break;case"assistbug":r.simulator=!0,r.simulation=[];for(var i=0,o=0;o<5;o++){for(var a=0;a<4;a++)r.simulation.push({type:"nextRandom",val:0,time:i+=100}),r.simulation.push({type:"nextRandom",val:0,time:i+=100});r.simulation.push({type:"nextRandom",val:0,time:i+=100})}}return!0===t.clickTick&&(r.clickTick=!0),"1"===t.logger&&(r.logger=!0),"lite"===t.view&&window.document.body.classList.add("lite-view"),(n=new ln(r,null,e)).init(),n}function Dn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Un=new WeakMap,Gn=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Un.set(this,{writable:!0,value:void 0})}var e,n,r;return e=t,(n=[{key:"initialize",value:function(){throw new Error("Missing implementation")}},{key:"initializeInput",value:function(){}},{key:"initRender",value:function(){throw new Error("Missing implementation")}},{key:"clear",value:function(){throw new Error("Missing implementation")}},{key:"setGame",value:function(t){!function(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,Un,t)}},{key:"game",get:function(){return function(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}(this,Un)}}])&&Dn(e.prototype,n),r&&Dn(e,r),t}();function Hn(t,e){throw new Error("Not implemented")}window.exportMainImage=Hn;var qn=n(0),Fn=n(3);function zn(t){return(zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vn(t,e)}function Vn(t,e){return(Vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Yn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Jn(t);if(e){var i=Jn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return $n(this,n)}}function $n(t,e){return!e||"object"!==zn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Jn(t){return(Jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Kn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Zn(t,e,n){return e&&Qn(t.prototype,e),n&&Qn(t,n),t}function tr(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var er=new WeakMap,nr=function(){function t(e){Kn(this,t),er.set(this,{writable:!0,value:void 0}),function(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,er,e)}return Zn(t,[{key:"addColor",value:function(t,e){tr(this,er).addColorStop(t,e.toRGBAString())}},{key:"compile",value:function(){return tr(this,er)}}]),t}(),rr=function(t){Xn(n,t);var e=Yn(n);function n(t,r,i,o,a,u,s){return Kn(this,n),e.call(this,t.createRadialGradient(r,i,o,a,u,s))}return Zn(n)}(nr),ir=function(t){Xn(n,t);var e=Yn(n);function n(t,r,i,o,a){return Kn(this,n),e.call(this,t.createLinearGradient(r,i,o,a))}return Zn(n)}(nr);function or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ar(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function ur(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}var sr=[],cr=new WeakMap,lr=new WeakMap,fr=new WeakMap,hr=new WeakMap,vr=new WeakMap,dr=function(){function t(e,n,r,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),cr.set(this,{writable:!0,value:void 0}),lr.set(this,{writable:!0,value:void 0}),fr.set(this,{writable:!0,value:void 0}),hr.set(this,{writable:!0,value:void 0}),vr.set(this,{writable:!0,value:void 0}),ur(this,cr,e),ur(this,lr,n),ur(this,fr,r),ur(this,hr,i),ur(this,vr,o)}var e,n,r;return e=t,(n=[{key:"key",get:function(){return"C:"+ar(this,cr).toRGBAString()+"W:"+ar(this,lr)+"H:"+ar(this,fr)+"X:"+ar(this,hr)+"Y:"+ar(this,vr)}},{key:"matches",value:function(t){return this.key===t.key}}])&&or(e.prototype,n),r&&or(e,r),t}();function gr(t,e,n,r,i){var o=new dr(t,e,n,r,i),a=sr.filter((function(t){return o.matches(t.key)}));if(a.length>0)return a[0].data;var u={key:o};return u.data=function(t,e,n,r,i){var o=new qn.a("canvas").el;o.width=e*r,o.height=n*i;var a=o.getContext("2d");a.strokeStyle=t.toRGBAString(),a.lineWidth=2;for(var u=0;u<=r;u++)a.beginPath(),a.moveTo(u*e,0),a.lineTo(u*e,o.height),a.closePath(),a.stroke();for(var s=0;s<=i;s++)a.beginPath(),a.moveTo(0,s*n,0),a.lineTo(o.width,s*n),a.closePath(),a.stroke();return a.getImageData(0,0,o.width,o.height)}(t,e,n,r,i),sr.push(u),u.data}function pr(t,e,n,r,i,o){var a=gr(e,n,r,i,o);t.putImageData(a,0,0)}function yr(t){return(yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mr(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return br(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return br(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function br(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function wr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xr(t,e,n){return e&&kr(t.prototype,e),n&&kr(t,n),t}function Mr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sr(t,e)}function Sr(t,e){return(Sr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Er(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Cr(t);if(e){var i=Cr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tr(this,n)}}function Tr(t,e){return!e||"object"!==yr(e)&&"function"!=typeof e?Or(t):e}function Or(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Cr(t){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pr(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function Br(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var Ir=m.engine.EngineBase,Ar=o.color.Color,jr=m.gameController.executeTick,Rr=u.Brick,Wr=new WeakMap,Nr=new WeakMap,_r=new WeakMap,Lr=new WeakMap,Dr=new WeakMap,Ur=new WeakMap,Gr=new WeakMap,Hr=new WeakMap,qr=new WeakMap,Fr=function(t){Mr(n,t);var e=Er(n);function n(t){var r;wr(this,n),r=e.call(this),Wr.set(Or(r),{writable:!0,value:30}),Nr.set(Or(r),{writable:!0,value:void 0}),_r.set(Or(r),{writable:!0,value:void 0}),Lr.set(Or(r),{writable:!0,value:void 0}),Dr.set(Or(r),{writable:!0,value:void 0}),Ur.set(Or(r),{writable:!0,value:void 0}),Gr.set(Or(r),{writable:!0,value:void 0}),Hr.set(Or(r),{writable:!0,value:void 0}),qr.set(Or(r),{writable:!0,value:null});var i=new qn.a(t.container).append(qn.a.stringToElement(Fn));return Pr(Or(r),Nr,i.querySelector("[data-target=gameCanvas]").el),Pr(Or(r),_r,i.querySelector("[data-target=holdingCanvas]").el),Pr(Or(r),Lr,i.querySelector("[data-target=nextCanvas]").el),Pr(Or(r),Hr,i.querySelector("[data-target=score]").el),Pr(Or(r),Dr,Br(Or(r),Nr).getContext("2d")),Pr(Or(r),Ur,Br(Or(r),_r).getContext("2d")),Pr(Or(r),Gr,Br(Or(r),Lr).getContext("2d")),r}return xr(n,[{key:"score",get:function(){return Br(this,Hr)}},{key:"brickSize",get:function(){return Br(this,Wr)},set:function(t){Pr(this,Wr,t)}},{key:"gameCanvas",get:function(){return Br(this,Nr)}},{key:"gameCtx",get:function(){return Br(this,Dr)}},{key:"holdingCanvas",get:function(){return Br(this,_r)}},{key:"nextCanvas",get:function(){return Br(this,Lr)}},{key:"initializeInput",value:function(){var t=this.game;this.gameCanvas.addEventListener("click",(function(){!0===t.setup.clickTick&&jr(t)})),window.addEventListener("keydown",(function(e){switch(e.keyCode){case 37:e.preventDefault(),t.input.left();break;case 38:e.preventDefault(),t.input.rotate();break;case 39:e.preventDefault(),t.input.right();break;case 40:e.preventDefault(),t.input.down();break;case 32:e.preventDefault(),!0!==e.repeat&&t.input.smashDown();break;case 27:e.preventDefault(),t.running&&t.runEvent("fx",null,"sound","menuback");break;case 16:e.preventDefault(),t.input.hold()}}),!1);var e=null;this.gameCanvas.addEventListener("touchstart",(function(t){var n=t.changedTouches[0];e={x:n.screenX,y:n.screenY}})),this.gameCanvas.addEventListener("touchend",(function(n){for(var r=n.changedTouches[0],i=r.screenX,o=r.screenY,a=i-e.x,u=o-e.y,s=Math.atan2(u,a)*(180/Math.PI);s<0;)s+=360;s>120&&s<220?t.input.left():s>340||s<40?t.input.right():s<115&&s>65?t.input.smashDown():console.debug(s)})),this.holdingCanvas.addEventListener("click",(function(){t.holdingShift()}))}},{key:"clearCanvases",value:function(){this.clearCanvas(Br(this,Dr),this.canvasWidth,this.canvasHeight),this.clearCanvas(Br(this,Ur),4*this.brickSize,4*this.brickSize),this.clearCanvas(Br(this,Gr),4*this.brickSize,4*this.brickSize)}},{key:"clear",value:function(){this.clearState()}},{key:"drawGrid",value:function(){pr(Br(this,Dr),this.game.gridColor,this.brickSize,this.brickSize,this.game.width,this.game.height);var t=this.brickSize/1.5;pr(Br(this,Gr),this.game.gridColor,t,t,6,6),pr(Br(this,Ur),this.game.gridColor,t,t,6,6)}},{key:"clearState",value:function(){null==Br(this,qr)&&(Pr(this,qr,{}),Br(this,qr).bricks={holding:[],game:[],next:[]}),this.clearArray(Br(this,qr).bricks.holding);var t=this.clearArray(Br(this,qr).bricks.game);return this.clearArray(Br(this,qr).bricks.next),t}},{key:"clearArray",value:function(t){return t.splice(0,t.length)}},{key:"addToState",value:function(t){var e=t.brick,n=t.old,r=t.state,i=t.x,o=t.y,a=t.blocks,u=t.color,s=t.scale,c=void 0===s?1:s;void 0===n&&(n=r);var l=null!=e?n.filter((function(t){return t.brick===e}))[0]:null;if("number"!=typeof i){if(!(e instanceof Rr))throw new Error("Missing x coordinate");i=e.x}if("number"!=typeof o){if(!(e instanceof Rr))throw new Error("Missing x coordinate");o=e.y}if(null==l?((l={brick:e}).fromX=i,l.fromY=o):(l.fromX=l.currentX,l.fromY=l.currentY),-1===r.indexOf(l)&&r.push(l),l.toX=i,l.toY=o,void 0===a){if(!(e instanceof Rr))throw new Error("Missing blocks");a=e.blocks}if(l.blocks=a,void 0===u){if(!(e instanceof Rr))throw new Error("Missing color");u=e.color}l.color=u,l.scale=c,l.fromStamp=(new Date).getTime()}},{key:"drawBricks",value:function(){var t=this.clearState(),e=this.game.bricks;for(var n in e){if(this.game.ghostDrawing&&e[n].moving){var r=new Ar(255,255,255,.2),i=e[n].getLowestPosition();this.addToState({state:Br(this,qr).bricks.game,blocks:e[n].blocks,x:e[n].x,y:i,color:r})}this.addToState({state:Br(this,qr).bricks.game,old:t,brick:e[n]})}this.addToState({state:Br(this,qr).bricks.next,blocks:this.game.brickforms[this.game.nextRandom],x:2,y:2,color:this.game.colors[this.game.nextRandom],scale:1.5}),null!=this.game.holding&&this.addToState({state:Br(this,qr).bricks.holding,brick:this.game.holding,x:2,y:2,scale:1.5})}},{key:"drawStates",value:function(){this.drawState(Br(this,qr).bricks.holding,Br(this,Ur)),this.drawState(Br(this,qr).bricks.game,Br(this,Dr)),this.drawState(Br(this,qr).bricks.next,Br(this,Gr))}},{key:"mix",value:function(t,e,n){return t*(1-n)+e*n}},{key:"updateBrickState",value:function(t){t.currentX=t.toX,t.currentY=t.toY}},{key:"drawState",value:function(t,e){var n,r=mr(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.updateBrickState(i),this.drawBrickForm(i.blocks,e,i.currentX,i.currentY,i.color,i.scale)}}catch(t){r.e(t)}finally{r.f()}}},{key:"drawBrickForm",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;for(var a in t)for(var u in t[a])1==t[a][u]&&this.drawSquare(e,n+parseInt(u),r+parseInt(a),i,o)}},{key:"drawSquare",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this.brickSize/i,a=e*o,u=n*o,s=o,c=o,l=new rr(t,a+s/2,u+c/2,0,a+s/2,u+c/2,40);l.addColor(0,r),l.addColor(1,r.alphaScale(.5)),t.fillStyle=l.compile(),t.fillRect(a,u,s,c),(l=new ir(t,a+s/2,u,a+s/2,u+c)).addColor(.2,r.alpha(.5)),l.addColor(0,Ar.Black().alpha(.9)),t.fillStyle=l.compile(),t.fillRect(a,u,s,c),(l=new ir(t,a,u+c/2,a+s,u+c/2)).addColor(.3,r.scale(.7).alpha(0)),l.addColor(0,Ar.Black().alpha(.4)),t.fillStyle=l.compile(),t.fillRect(a,u,s,c),(l=new ir(t,a+s/2,u,a+s/2,u+c)).addColor(.8,r.scale(.1).alpha(0)),l.addColor(1,Ar.Black()),t.fillStyle=l.compile(),t.fillRect(a,u,s,c),(l=new ir(t,a,u+c/2,a+s,u+c/2)).addColor(.8,r.scale(.2).alpha(0)),l.addColor(1,Ar.Black()),t.fillStyle=l.compile(),t.fillRect(a,u,s,c)}},{key:"clearCanvas",value:function(t,e,n){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.canvas.width=e,t.canvas.height=n}},{key:"canvasWidth",get:function(){return this.brickSize*this.game.width}},{key:"canvasHeight",get:function(){return this.brickSize*this.game.height}},{key:"initRender",value:function(){var t=this;this.render(!0,!0),this.game.addEvent("update-score",(function(e){t.score.innerHTML=e}))}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.game;if((!0===t||n.PENDINGUPDATE)&&(this.drawBricks(),n.PENDINGUPDATE=!1),this.clearCanvases(),this.drawGrid(),this.drawStates(),!0===e){var r=this;requestAnimationFrame((function(){return r.render(!1,e)}))}}}]),n}(Ir);function zr(t){return 440*Math.pow(2,(t-57)/12)}function Xr(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=Math.sin(u*Math.PI/180),c=1-a/o,l=Math.min(a/(o/32),1);t[e+a]=s*c*l*.4}}function Vr(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=Math.sin(u*Math.PI/180),c=1-a/o,l=Math.min(a/(o/32),1);t[e+a]=s*c*l*.4}}function Yr(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=Math.sin(u*Math.PI/180);s=s>0?1:-1;var c=1-a/o,l=Math.min(a/(o/32),1),f=a/o;t[e+a]+=f*s*c*l*.4}}function $r(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=Math.sin(u*Math.PI/180);s=Math.max(-1,Math.min(1,2*s));var c=Math.min(a/(o/32),1);t[e+a]+=s*c*.4}}var Jr=[{name:"gamelose",buffer:function(t){var e=t.sampleRate,n=2.706*e,r=t.createBuffer(1,n,e),i=r.getChannelData(0),o=60/140/4,a=0;return Xr(i,a,zr(60),.04,e),Xr(i,a+=Math.floor(e*o),zr(60),.04,e),Xr(i,a+=Math.floor(e*o),zr(57),.04,e),Xr(i,a+=Math.floor(e*o),zr(62),.04,e),Xr(i,a+=Math.floor(e*o),zr(60),.04,e),Xr(i,a+=Math.floor(e*o*2),zr(57),.04,e),r}},{name:"gamebump",buffer:function(t){var e=t.sampleRate,n=.5*e,r=t.createBuffer(1,n,e);return function(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=1-a/o;u*=(1+Math.sin(45*s*Math.PI/180))/2;var c=Math.sin(u*Math.PI/180),l=Math.min(a/(o/32),1);t[e+a]=c*s*l*.4}}(r.getChannelData(0),0,zr(53),.05,e),r}},{name:"gamerow",buffer:function(t){var e=t.sampleRate,n=2.706*e,r=t.createBuffer(1,n,e),i=r.getChannelData(0),o=0;return Vr(i,o,zr(60),.04,e),Vr(i,o+=Math.floor(e*(60/170/4)/2),zr(64),.04,e),Vr(i,o+=Math.floor(e*(60/170/4)/2),zr(72),.04,e),r}},{name:"gamemove",buffer:function(t){var e=t.sampleRate,n=.5*e,r=t.createBuffer(1,n,e);return function(t,e,n,r,i){for(var o=i*r,a=0;a<o;a++){var u=a/o*n*(360*r),s=Math.sin(u*Math.PI/180),c=1-a/o,l=a/o,f=Math.min(a/(o/32),1);t[e+a]=l*s*c*f*.6}}(r.getChannelData(0),0,zr(50),.05,e),r}},{name:"menumusic",buffer:function(t){var e=t.sampleRate,n=15*e,r=t.createBuffer(1,n,e),i=r.getChannelData(0);return function(t,e,n){var r=Math.floor(n*(t/2)),i=function(t,i,o){for(var a=0;a<i;a++){var u=o[a%o.length];Yr(e,t,zr(u),.04,n),t+=r}return t},o=0;o=i(o,8,[64,69,72]),o=i(o,8,[64,69,71]),o=i(o,8,[65,69,72]),o=i(o,4,[64,69,74]),o=i(o,4,[67,72,76]),o=i(o,8,[65,69,74]),o=i(o,8,[65,69,72]),o=i(o,8,[64,69,72]),o=i(o,4,[64,69,71]),o=i(o,4,[67,72,76])}(60/128,i,e),function(t,e,n){var r=Math.floor(n*t),i=t/2,o=function(t,o,a){for(var u=0;u<o;u++)$r(e,t+r/2,zr(a),i,n),$r(e,t+r/2,zr(a+12),i,n),t+=r;return t},a=0;a=o(a,4,21),a=o(a,4,23),a=o(a,4,17),a=o(a,2,21),a=o(a,2,24),a=o(a,4,26),a=o(a,4,24),a=o(a,4,21),a=o(a,2,26),a=o(a,2,24)}(60/128,i,e),r}}];function Kr(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Qr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Qr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ti(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ei(t,e,n){var r=e.get(t);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(t,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function ni(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var ri=new WeakMap,ii=new WeakMap,oi=new WeakMap,ai=new WeakMap,ui=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ti(this,"activated",!0),ti(this,"ready",!1),ri.set(this,{writable:!0,value:null}),ii.set(this,{writable:!0,value:null}),ti(this,"failed",!1),oi.set(this,{writable:!0,value:[]}),ai.set(this,{writable:!0,value:!1})}var e,n,r;return e=t,(n=[{key:"init",value:function(){if(!1!==ni(this,ai))throw new Error("SoundController can only be initialized once");ei(this,ai,!0);try{ei(this,ri,new AudioContext);var t,e=Kr(Jr);try{for(e.s();!(t=e.n()).done;){var n=t.value;console.log(n),ni(this,oi)[n.name]=n.buffer(ni(this,ri))}}catch(t){e.e(t)}finally{e.f()}this.ready=!0}catch(t){console.error(t),ei(this,ri,null),this.failed=!0}this.ready=!0}},{key:"allSoundKeys",get:function(){return Object.keys(ni(this,oi))}},{key:"playSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.throwErrors,r=void 0!==n&&n;if(1==this.failed)return!1;if(!0!==this.activated)return console.debug("sound deactivated"),!1;if(console.debug("playSound:"+t),!0!==this.ready)return console.warn("tried to play sound before ready"),!1;if(!(ni(this,ri)instanceof AudioContext))return console.debug("tried to play sound with an invalid AudioContext"),!1;try{var i=ni(this,ri).createBufferSource();i.loop=!1,i.buffer=ni(this,oi)[t],i.playbackRate.value=1,i.connect(ni(this,ri).destination),i.start(0);var o=i.buffer.length/ni(this,ri).sampleRate*1e3+100;return setTimeout((function(){return i.disconnect()}),o),!0}catch(t){if(console.warn(t),r)throw t;return!1}}}])&&Zr(e.prototype,n),r&&Zr(e,r),t}(),si=m.init,ci=si.init,li=si.Options,fi=b.addon.INIT_TYPES,hi="#container";"string"==typeof hi&&(hi=window.document.body.querySelector(hi));var vi=new Fr({container:hi=new qn.a(hi)}),di=new li,gi=new URL(location.href);null!=gi.searchParams.get("setup")&&(di.setup=gi.searchParams.get("setup")),null!=gi.searchParams.get("next")&&(di.next=gi.searchParams.get("next")),null!=gi.searchParams.get("simulate")&&(di.simulate="1"===gi.searchParams.get("simulate")||gi.searchParams.get("simulate")),null!=gi.searchParams.get("clickTick")&&(di.clickTick="1"===gi.searchParams.get("clickTick")),null!=gi.searchParams.get("logger")&&(di.logger=gi.searchParams.get("logger")),null!=gi.searchParams.get("view")&&(di.view=gi.searchParams.get("view")),null!=gi.searchParams.get("debug")&&(di.debug=gi.searchParams.get("debug"));var pi=ci(di,vi);"1"===di.debug&&n(11).initDebug(hi.parentElement,hi.el,pi),"off"!==di.sound&&pi.registerAddon(new ui,(function(t,e){t.init(),e.addEvent("fx",(function(e,n){"sound"===e&&t.playSound(n)}))}),fi.AFTER_INIT)}]);